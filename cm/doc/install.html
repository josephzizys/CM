<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <meta content="text/html; charset=iso-8859-1"
 http-equiv="content-type"/>
  <style media="all" type="text/css">
@import "css/cm.css";
  </style>
  <title>Installing Common Music</title>
</head>
<body>
<!-- Navbar -->
<div id="header">
<div id="logo"><img title="" alt="[img/cmlogosw.png]" height="50"
 width="50" src="img/cmlogosw.png"/>
</div>
<div class="inv">Navigation:</div>
<ul class="nav">
  <li class="nav1"><a href="cm.html">Home Page</a></li>
  <li class="navn"><a href="dict/">Dictionary</a></li>
  <li class="navn"><a href="../etc/examples/">Examples</a></li>
</ul>
</div>
<hr class="inv"/>
<div id="content">

<h1>Installing Common Music</h1>

<h2>Contents</h2>
<ol>
  <li><a href="#preinstallation">Pre-installation</a></li>
  <li><a href="#installing">Installing Sources</a></li>
  </li>
  <li>
    <a href="#starting">Starting CM</a>
  </li>
  <li><a href="#loading">Programs and Interfaces</a>
    <ol>
      <li><a href="#cffi">CFFI</a></li>
      <li><a href="#clm">CLM</a></li>
      <li><a href="#cmn">CMN</a></li>
      <li><a href="#cm-gui">CM-GUI</a></li>
      <li><a href="#fomus">Fomus</a></li>
      <li><a href="#lambda-gtk">Lambda GTK</a></li>
      <li><a href="#midishare">Midishare</a></li>
      <li><a href="#player">Player</a></li>
      <li><a href="#portmidi">Portmidi</a></li>
    </ol>
  </li>
  <!--
  <li><a href="#appendic">Appendix</a>
  <ol>
  <li><a href="#start_lisp">Starting a Lisp application</a></li>
  <li><a href="#clisp.bat">Installing a CLISP command on Windows</a></li>
  <li><a href="#trouble_dosdir">The DOS directory character in Lisp</a></li>
  </ol>
  </li>
  -->
</ol>

<h2 id="preinstallation">Pre-installation</h2>

<p>
To build Common Music from its sources you must have write permission
in an installation directory, a working lisp command on your execution
path and some familiarity with the shell, or terminal, application.
If you are going to use CM in conjunction with other lisp programs
like CLM or Fomus, or with Lisp interfaces to external programs such
as Portmidi and Midishare, you should create a common "parent"
directory to contain the different Lisp systems so that you can load
them transparently
using <a href="dict/use-system-fn.html">use-system</a>. It does not
matter where on the file system this Lisp installation directory is
located; for sake of illustration this document assumes that the lisp
software systems are all installed under "/usr/local/lisp".
</p>

<div class="float">
<p class="captxt">Installing Lisp music packages under a common parent
directory will allow you to load the separate systems transparently
using use-system. This listing shows the various lisp systems and
interfaces discussed in this document.</p>
<pre class="shell">
$ ls -l /usr/local/lisp
drwxr-xr-x   15 hkt  admin   510 14 Nov 13:56 cffi/
drwxr-xr-x  188 hkt  admin  6392 14 Nov 09:57 clm-3/
drwxr-xr-x    9 hkt  admin   306 21 Nov 09:59 cm/
drwxr-xr-x   64 hkt  admin  2176 25 Oct 12:46 cmn/
drwxr-xr-x   64 hkt  admin  2176 11 Nov 08:10 fomus/
drwxr-xr-x   11 hkt  admin   374  5 Oct 17:28 lambda-gtk/
drwxr-xr-x    7 hkt  admin   238 26 Oct 18:04 midishare/
drwxr-xr-x    5 hkt  admin   170 21 Nov 17:44 portmidi/
</pre>
</div>

<h2 id="installing">Installing Sources</h2>
<p>
Sources for stable and developmental releases can be downloaded
in tarball archives (cm.tar.gz) or via anonymous CVS.
</p>

<h3 id="tarball-install">Tarball Installation</h3>
<ul>
<li>
Archives of stable releases are available from
 CM's <a href="http://www.sf.net/projects/commonmusic">Sourceforge
 Project</a> page.
</li>

<li>
Current development sources are available as a  <a
href="http://commonmusic.sourceforge.net/cm.tgz">nightly snapshot</a>.
</li>
</ul>

<p>
To install CM from a tarball simply download the archive and restore
it under your Lisp installation directory:

<pre class="shell">
$ <span class="input">cd /usr/local/lisp</span>
$ <span class="input">tar -zxf cm.tar.gz</span>
</pre>

<h3 id="cvs-install">CVS Installation</h3>

<p>
Sources to Common Music are maintained in a CVS repository organized
into <em>release branches</em> and tagged by release numbers.  By
convention, even numbered branches denote stable software releases and
odd numbered branches denote unstable, or developmental, branches.
The CVS <em>head branch</em> &#8212; the branch you get if you do not
specify any release tag &#8212; points to the very latest
developmental sources.
</p>

<p>
To install the latest developmental sources via CVS:
</p>

<ol>

<li>
<p>
Change directories to your Lisp installation directory.
</p>
</li>

<li><p>Set the shell variable CVSROOT to point to the CVS repository:</p></li>

<pre class="shell">
$ <span class="input">export CVSROOT=":pserver:anonymous@cvs.sourceforge.net:/cvsroot/commonmusic"</span> 
</pre>

<li>
<p>
Use <code>cvs login</code> to connect to the Sourceforge CVS
server, press Enter when prompted for a password:
</p>

<pre class="shell">
$ <span class="input">cvs login</span>
CVS password:</pre>
</li>

<li>
<p>
Use <code>cvs checkout</code> to restore CM's source tree to your Lisp installation directory:
</p>

<pre class="shell">
$ <span class="input">cvs checkout -P cm</span>
</pre>
</li>
</ol>

<p>
After the source tree has been restored you do not need to
use <code>login</code> or <code>checkout</code> again.  You can
periodically update your CM installation tree to the most recent file
versions from the Sourceforge repository by executing <code>cvs
update</code> from inside the top-level CM directory:

<pre class="shell">
$ <span class="input">cd /usr/local/lisp/cm</span>
$ <span class="input">cvs update</span>
</pre>


<h2 id="start_lisp">Starting Common Music</h2>

<p>
Once the sources have been installed on your local machine and you
have a shell command that starts a supported lisp implementation, you
can start Common Music. There are a number of different ways to do
this, here are some typical strategies:
</p>

<ol>

<li>
<p>
To start Common Music from the Shell use
the <a href="dict/cm-sh.html"><code>cm.sh</code></a> script located in
CM's binary directory. You must have a valid Lisp command installed on
your path for this to work.
</p>

<pre class="shell">
$ <span class="input">/usr/local/lisp/cm/bin/cm.sh</span>
</pre>

<p>
Consider installing a global command that
runs <a href="dict/cm-sh.html">cm.sh</a> without having to type its
pathname. This example adds a <code>cm</code> command to /usr/bin that
starts the script simply by typing <code>cm</code> to the shell
prompt:
</p>

<pre class="shell">
$ <span class="input">sudo ln -s /usr/bin/cm /usr/local/lisp/cm/bin/cm.sh<span>
</pre>

<p>By specifying the <code>-l</code> and <code>-e</code> options you
can launch CM under Emacs in any supported Lisp. Examples:
</p>

<pre class="shell">
$ <span class="input">cm -l openmcl -e Emacs</span>
$ <span class="input">cm -l gosh -e xemacs</span>
$ <span class="input">cm -l clisp -e emacs</span>
</pre>
</li>

<li>
<p>
To start Common Music from the Common Lisp REPL load "cm.lisp" from
CM's source directory and then use the <code>(cm)</code> function to
make the CM symbol package and readtable current:
</p>

<pre class="shell">
&gt; <span class="input">(load "/usr/local/lisp/cm/src/cm.lisp")</span>
&gt; <span class="input">(cm)</span>
</pre>
</li>

<li>
<p>
To start Common Music from the Scheme REPL load "cm.scm" from CM's
source directory:
</p>

<pre class="shell">
&gt; <span class="input">(load "/usr/local/lisp/cm/src/cm.scm")</span>
</pre>
</li>


<li>
<p>
To start Common Music from inside Emacs add the following code to your
~/.emacs file. The example code assumes you have installed
the <code>cm</code> shell command described in the first example:
</p>

<pre class="code">
(add-to-list 'load-path <span class="string">"/usr/local/lisp/cm/etc/xemacs"</span>)
(load <span class="string">"cm.el"</span>)
(setq inferior-lisp-program <span class="string">"cm"</span>)
</pre>

<p>
Restart Emacs and type <span class="input">C-x l</span> to start CM in
a dedicated Emacs buffer. See <a href="emacs.html">Running Common
Music under Emacs</a> for more information.
</p>
</li>
</ol>

<p>
Regardless of which method you use to start CM the system will
automatically generate, compile and load files as needed during the
startup process. Once the files have been loaded CM will look for your
"~/.cminit.lisp" customization file and automatically load it if it
exists.
</p>

<h2>Loading Lisp Programs and Interfaces</h2>

<p>
Once CM is running you can load other Lisp programs and interfaces
into the same Lisp image using
the <a href="dict/use-system-fn.html">use-system</a> function. This
facility works transparently if the other Lisp software packages all
share the same parent directory as your CM installation directory. To
load programs and interfaces as part of CM's normal start up process
add the appropriate <a href="dict/use-package-fn.html">use-package</a>
forms to either
<a href="../src/cm.lisp">cm.lisp</a> or to your personal
~/.cminit.lisp file. The <code>use-system</code> facility will automatically
compile source code as necessary during the loading process.
</p>

<p>
The following Common Lisp packages can be loaded with
<a href="dict/use-system-fn.html">use-system</a>:
</p>

<h3 id="cffi">CFFI</h3>
<p><code>(use-system :cffi)</code></li></p>
The Common Foreign Function interface for Common Lisp, by James Bielman and Luís Oliveira.  Required by the <a href="#portmidi">Portmidi</a> and <a href="#midishare">Midishare</a> interfaces.

<ul>
<li>Homepage: <a href="http://common-lisp.net/project/cffi/">
http://common-lisp.net/project/lambda-gtk/</a></li>
<li>Downloads: <a href="http://common-lisp.net/project/cffi/tarballs/">http://common-lisp.net/project/cffi/tarballs/</a></li>
<li>Supporting: Allegro, CLISP, CMUCL, Lispworks, OpenMCL, SBCL</li>
<li>Installation: Restore sources under the Lisp installation directory.</li>
</ul>

<h3 id="clm">CLM</h3>
<p><code>(use-system :clm)</code></li></p>
<p>
Common Lisp Music, by William Schottstaedt. A sound synthesis package
for Common Lisp and Scheme (Guile/Snd).
</p>
<ul>
<li>Homepage: <a href="http://www-ccrma.stanford.edu/software/clm/">
http://www-ccrma.stanford.edu/software/clm/
</a></li>
<li>Downloads: <a href="ftp://ftp-ccrma.stanford.edu/pub/Lisp/clm-3.tar.gz">
ftp://ftp-ccrma.stanford.edu/pub/Lisp/clm-3.tar.gz
</a></li>
<li>Requirements: GCC, X Windows (OSX: XCode developer)
<li>Supporting: Linux, OS X: Allegro, CMUCL, OpenMCL, SBCL</li>
<li>Installation: Restore sources under the Lisp installation directory.</li>
</ul>
<p>
CLM instrument files must be compiled inside the CM package in order
to work with the <a href="dict/process-mac.html">process</a> macro.
</p>

<h3 id="cmn">CMN</h3>
<p><code>(use-system :cmn)</code></li></p>
<p>
Common Music Notation, by William Schottstaedt. A music notation
package for Common Lisp.
</p>
<ul>
<li>Homepage: <a href="http://www-ccrma.stanford.edu/software/cmn/">
http://www-ccrma.stanford.edu/software/cmn/
</a></li>
<li>Downloads: <a href="ftp://ftp-ccrma.stanford.edu/pub/Lisp/cmn.tar.gz">
ftp://ftp-ccrma.stanford.edu/pub/Lisp/cmn.tar.gz
</a></li>
<li>Supporting: Allegro, Clisp, CMUCL, OpenMCL, SBCL</li>
<li>Installation: Restore sources under the Lisp installation
directory.</li>
</ul>

<h3 id="cm-gui">CM-GUI</h3>
<p><code>(use-system :cm-gui)</code></li></p>
<p>
Graphical User Interface for CM, by Rick Taube.
</p>
<ul>
<li>Homepage: <a href="http://common-lisp.net/project/lambda-gtk/">
http://common-lisp.net/project/cffi/</a></li>
<li>Downloads: not available yet.
<li>Requirements: <a href="#lambda-gtk">lambda-gtk</a>
<li>Supporting: Linux, OSX: CMUCL, OpenMCL, SBCL</li>
<li>Installation: Restore sources under the Lisp installation directory.</li>
</ul>








<h3 id="fomus">Fomus</h3>
<p><code>(use-system :fomus)</code></li></p>
<p>
Fomus, by David Psenicka. A music notation package for Common Lisp.
</p>
<ul>
<li>Homepage: <a href="http://common-lisp.net/project/fomus/">
http://common-lisp.net/project/fomus</a></li>
<li>Downloads:  CVS only</li>
<li>Supporting: Linux, OS X: CMUCL, OpenMCL, SBCL</li>
<li>Installation: Restore sources under the Lisp installation directory using this CVS command:
<pre>cvs -z3 -d :pserver:anonymous:anonymous@common-lisp.net:/project/fomus/cvsroot co fomus</pre>
</li>
</ul>

<h3 id="lambda-gtk">lambda-gtk</h3>
<p><code>(use-system :lambda-gtk)</code></li></p>
<p>
Lambda GTK, by Rick Taube. A Common Lisp interface to GTK+ 2.0.
</p>
<ul>
<li>Homepage: <a href="http://common-lisp.net/project/lambda-gtk/">
http://common-lisp.net/project/cffi/</a></li>
<li>Downloads: not available yet.
<li>Requirements:, X Windows, GTK+ 2.0 (OSX: XCode developer, Fink)
<li>Supporting: Linux, OSX: CMUCL, OpenMCL, SBCL</li>
<li>Installation: Restore sources under the Lisp installation directory using this CVS command:
<pre>cvs -z3 -d :pserver:anonymous:anonymous@common-lisp.net:/project/lambda-gtk/cvsroot co lambda-gtk</pre>
</li>
</ul>

<h3 id="midishare">Midishare Interface</h3>
<p><code>(use-system :midishare)</code></li></p>
<p>
A Common Lisp interface
to <a href="http://midishare.sourceforge.net/">Midishare</a>, a
real-time MIDI operating system by <a href="www.grame.fr">Grame</a>.
</p>
<ul>
<li>Downloads:  not available yet</li>
<li>Supporting: Clisp, CMUCL, Lispworks, OpenMCL, SBCL</li>
<li>Requirements: <a href="#cffi">CFFI</a>
<li>Installation: 
<ol>
<li>
Download and restore the most recent <a href="http://sourceforge.net/projects/midishare/">Midishare distribution</a></li>
<li>Configure MidiShare driver ports with msDriver and test MIDI
connections with msController before attempting to load the
interface.
</li>
<li>
Restore the sources under the Lisp installation directory.
</li>
</ol>
</li>
</ul>
<p>
See the <a href="dict/midishare-topic.html">midishare</a> topic help for more information about working with Midishare in CM.
</p>

<h3 id="player">Player Interface</h3>
<p><code>(use-system :player)</code></li></p>
<p>
A Common Lisp interface to
the <a href="http://midishare.sourceforge.net/">Midishare</a> Player
sequencer.
</p>
<ul>
<li>Downloads:  not available yet</li>
<li>Supporting: Clisp, CMUCL, Lispworks, OpenMCL, SBCL</li>
<li>Requirements: <a href="#CFFI">CFFI</a>
<li>Installation: Restore sources under Lisp installation directory.</li>
</ul>

<h3 id="portmidi">Portmidi Interface</h3>
<p><code>(use-system :portmidi)</code></li></p>
<p>
A Common Lisp interface to
the <a href="http://www.cs.cmu.edu/~music/portmusic/">Portmidi</a> MIDI
library.
</p>

<ul>
<li>Downloads:  not available yet</li>
<li>Supporting: Clisp, CMUCL, Lispworks, OpenMCL, SBCL</li>
<li>Installation: Restore sources under Lisp installation directory.</li>
<li>Requirements: <a href="#CFFI">CFFI</a>
</ul>

<p>
See the <a href="dict/portmidi-topic.html">portmidi</a> topic help for more information about working with Portmidi in CM.
</p>


<!--
<h2 id="appendix">6. Appendix</h2>

<h3>Installing Lisp Commands</h3>

<p>
In order to run Common Music you must install one of the supported lisp implementations. Most installation procedures also install a command to start Lisp from the shell.
</p>

If you are on OS X, Linux or Cygwin you can use the <code>which</code>
command to see if a Lisp command is installed properly on your path.
</p>

<div class="float">
<p class="captxt">Using 'which' to locate a lisp command (Linux, OS X, Cygwin).</p>
<pre class="shell">$ <span class="input">which clisp</span>
/usr/local/bin/clisp
$ <span class="input">which openmcl</span>
/Lisp/bin/openmcl
$ <span class="input">which guile</span>
/sw/bin/guile
$ <span class="input">which alisp</span>
alisp: Command not found.</pre>
</div>

<p>
<em>Even if your Lisp implementation does NOT come with an installed
command you should create and install one to simplify working with
Common Music</em>. There is not one single way to do this that will
work for all Lisp implementations and operating systems.  On OS X,
Linux or Cygwin, either copy the appropriate Lisp program/script to a
directory on your $PATH or edit your $PATH definition in
~/.bash_profile or ~/.cshrc to include the directory that contains the
Lisp program/script. On Windows 2000/XP install a batch file to start
CLISP, see <a href="#clisp.bat">clisp.bat</a> for information on how
to do this. On MacOS, double-click the MCL Common Lisp application to
start Lisp.
</p>




<dl>

The following table lists the commands, programs and image names for
each Lisp implementation. Follow the links for additional information.
</p>

<div class="float">
<p class="captxt">Application files for supported Lisp
implementations.
</p>
<table class="float">
  <tbody>
    <tr>
      <th style="padding-right: 1em; text-align: left;" class="col">Lisp</th>
      <th style="padding-right: 1em; text-align: left;" class="col">Command</th>
      <th style="text-align: left;" class="col">Executable</th>
      <th style="text-align: left;" class="col">Image</th>
 </tr>
    <tr>
      <td><a href="http://cvs.sourceforge.net/viewcvs.py/clisp/clisp/INSTALL?view=markup">CLISP</a></td>
      <td><a href="http://clisp.cons.org/clisp.html"><code>clisp</code></a></td>
      <td>./full/lisp(.exe) </td>
      <td>./full/lispinit.mem</td>
    </tr>
    <tr>
      <td><a href="http://www.cons.org/cmucl/install.html">CMU</a></td>
      <td><a href="http://www.pmsf.de/pub/cmucl/doc/cmu-user/introduction.html#toc2"><code>lisp</code></a></td>        
      <td>./bin/lisp </td>
      <td>./lib/cmucl/lib/lisp.core</td>
    </tr>
    <tr>
      <td><a href="http://openmcl.clozure.com/Doc/installation.html">OpenMCL</a></td>
      <td>
        <a href="http://openmcl.clozure.com/Doc/shell-script.html"><code>openmcl</code></a>
      </td>
      <td>./dppccl </td>
      <td>./dppccl.image</td>
    </tr>
    <tr>
      <td><a href="http://www.franz.com/support/documentation/6.1/doc/startup.htm">ACL</a></td>
      <td> </td>
      <td>./alisp(.exe) </td>
      <td>./lisp.dxl</td>
    </tr>
    <tr>
      <td><a href="http://www.shiro.dreamhost.com/scheme/gauche/index.html">Gauche</a></td>
      <td><a href="http://www.shiro.dreamhost.com/scheme/gauche/man/gauche-refe_13.html#SEC13"> <code>gosh</code></a></td> <td>gosh</td> <td></td>
    </tr>
    <tr>
      <td><a
      href="http://www.gnu.org/software/guile/docs/guile-ref/Obtaining-and-Installing-Guile.html#Obtaining%20and%20Installing%20Guile">Guile</a></td>
      <td><a
      href="http://www.gnu.org/software/guile/docs/guile-ref/Invoking-Guile.html#Invoking%20Guile"> <code>guile</code></a></td> <td>guile</td> <td></td>
    </tr>

    <tr>
      <td><a href="http://www.stklos.org">STklos</a></td>
      <td><code>stklos</code></td> <td>stklos</td> <td></td>
    </tr>
</tbody>
</table>
</div>


  <dt id="clisp.bat">3. Installing a CLISP command (Windows)</dt>
  <dd>When Clisp is installed on Windows it places a <em>shortcut</em>
to the program on your desktop. Unfortunately, this shortcut is not
very useful for working with Common Music or for running Clisp under
Emacs. Here is how to install a CLISP command on Windows 2000:
    <ol>
      <li>Copy the contents of the script file shown below and paste
it into a new window in Note Pad.</li>
      <li>Change the pathname in green to the actual path to CLISP on
your machine.</li>
      <li>Save the text in a file called "clisp.bat".</li>
      <li>Move the new clisp.bat file to some directory on your path,
for
example to C:\WINNT\System32\clisp.bat.</li>
    </ol>
    <div class="float">
    <p class="captxt">The clisp.bat script file for Windows 2000.</p>

    <pre class="code">@echo off<br/><br/><span style="color: blue;">REM Edit the clispdir pathname inside "" to point to</span>
<span style="color: blue;">REM the clisp installation directory on your machine.</span>

<span style="color: red;">set</span> clispdir="<span
 style="color: green;">\Lisp\clisp-2.31</span>"<br/><span
 style="color: red;">pushd</span> %clispdir%<br/>.\full\lisp.exe -B . -M .\full\lispinit.mem %1 %2 %3 %4 %5 %6 %7 %8 %9<br/><span
 style="color: red;">popd</span></pre>
    </div>
  </dd>
  <dt id="trouble_dosdir">4. The DOS directory character in Lisp (Windows)
  </dt>
  <dd>You must double each DOS directory delimiter when you specify
Window's
directories in Lisp strings, i.e.
"c:\\lisp\\cm-2.5.0\\readme.text" <em>not</em>
"c:\lisp\cm-2.5.0\readme.text". This is because \ is a special
quoting character inside Lisp strings; specifying two together
actually produces one \ in the string. If this is too confusing then
you should simply switch to using the Unix-style directory delimiter /
on Windows, for example "c:/path/to/cm/readme.text". Allegro,
Clisp and Guile all support Unix-style directory strings under
Windows.
  </dd>
</dl>

-->
    
<!-- end content -->
</div>
<div id="footer">
<div id="author">H. Taube</div>
<div id="cvs-info">$Name$: $Source:
/cvsroot/commonmusic/cm/doc/install.html,v $ ($Revision$, $Date:
2003/12/18 18:07:13 $)</div>
</div>
</body>
</html>
