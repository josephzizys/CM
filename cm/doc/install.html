<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1"/>
<style type="text/css" media="all">
@import "css/cm.css";
</style>
<title>Installing Common Music</title>
</head>

<body>

<!-- Navbar -->
<div id="header">
<div id="logo">
<img src="img/cmlogosw.png" width="50" height="50" alt="[img/cmlogosw.png]" title=""/>
</div>
<div class="inv">Navagation:</div>
<ul class="nav">
<li class="nav1"><a href="cm.html">Home Page</a></li>
<li class="navn"><a href="dict/">Dictionary</a></li>
<li class="navn"><a href="../etc/examples/">Examples</a></li>
</ul>
</div>
<hr class="inv"/>

<div id="content">

<h1>Installing Common Music</h1>
<p>
This document describes how to install Common Music in several common
configurations. Installing the system involves downloading the
sources, starting a <a href="cm.html#implementations">supported Lisp
implemetation</a>, compiling CM's sources and saving an image file
that contains the application in it. This image file is then used with
your Lisp program to run Common Music inside a Terminal window or
under
<a href="emacs.html">Emacs/Xemacs</a>. Once Common Music is running
you can load and work with additional software systems like
<a href="http://www-ccrma.stanford.edu/software/clm/">CLM</a>,
<a href="http://www-ccrma.stanford.edu/software/cmn/">CMN</a> and
<a href="http://www.grame.fr/MidiShare/">Midishare</a>.
</p>

<h2>Contents</h2>
<!--  style="list-style-type: upper-roman" -->
<ol>
<li><a href="#install_src">Downloading and restoring the
sources<a/></li>
<li><a href="#start_lisp">Starting your Lisp application</a></li>
<li><a href="#make_cm">Building Common Music from sources</a></li>
<li><a href="#run_cm">Running the Common Music application</a></li>
<li><a href="#install_sys">Working with CLM, CMN and MidiShare<a/></li>
</ol>

<h2 id="install_src">1. Downloading and restoring the sources</h2>

<p>
Common Music's sources can be installed from FTP archives or via
anonymous CVS. Although the CVS tree contains the most up-to-date
version of the system, these sources represent the "bleeding edge" of
development and may include bugs and untested features.
</p>

<h3 id="install_ftp">1.1 Downloading and restoring using FTP</h3>

<ol>
<li>
Download the latest CM source archive from either:
  <ul>
  <li><a href="http://www.sf.net/projects/commonmusic">Sourceforge
      Common Music Project</a></li>
  <li><a
         href="ftp://ftp-ccrma.stanford.edu/pub/Lisp/cm/sources/">ftp://ftp-ccrma.stanford.edu/pub/Lisp/cm/sources</a></li>
  </ul>
</li>

<li>
Place the downloaded archive in an appropriate directory on your
machine.  If you are going to work with other Lisp packages such as
<a href="http://www-ccrma.stanford.edu/software/clm/">CLM</a>
or
<a href="http://www-ccrma.stanford.edu/software/cmn/">CMN</a> you
should consider creating a parent Lisp directory to organize these
separate Lisp systems. For purposes of illustration, this document
assumes that the CM distribution archive (along with any additional
Lisp system) is restored in a parent directory called Lisp located
directly under the root directory of the file system:

<dl>
<dt class="platformnote">OS X and Linux:</dt> 
<dd><code>/Lisp/</code></dd>
<dt class="platformnote">Windows:</dt> 
<dd><code>C:\LISP\</code></dd>
<dt class="platformnote">MacOS:</dt> 
<dd><code>Macintosh HD:Lisp:</code></dd>
</dl>
</li>


<li>
Restore the CM source archive with whatever softare you use. This
process should restore the contents of the archive under a directory
named cm-{version}, where {version} is the version number of the CM
release. For example, the archive file cm-2.4.0.tar.gz should restore
Common Music in a directory called cm-2.4.0. This document will refer
to this restored directory as the <em>CM installation directory</em>.
<div class="float">
<p class="captxt">
Restoring the CM source archive on OS X and Linux.
</p>
<pre class="shell">% <span class="input">cd /Lisp</span>
% <span class="input">tar -zxvf cm-2.4.0.tar.gz</span>
<i>[...lots of printout deleted...]</i>
% <span class="input">ls -l cm-2.4.0</span>
drwxr-xr-x   5 hkt  admin   170 Nov 29 19:55 bin
drwxr-xr-x  11 hkt  admin   374 Nov 30 08:10 doc
drwxr-xr-x   7 hkt  admin   238 Nov 24 15:21 etc
-rw-r--r--   1 hkt  admin  1262 Nov 21 12:57 readme.text
drwxr-xr-x  58 hkt  admin  1972 Nov 29 20:41 src
% 
</pre>
</div>

<dl>
<dt class="platformnote">Windows and MacOS Note:</dt> 
<dd>
Since the archive is stored in gzipped unix tarfile format (.tar.gz),
make sure that your installer performs the necessary ASCII end-of-line
conversion when it unpacks the sources.  You can determine if it did
this correctly using <a
href="http://ccrma-www.stanford.edu/~craig/utility/flip/">flip -t</a>
or by editing the file <a
href="../readme.text">readme.text</a> in the top level CM
directory using Note Pad (Windows) or Simple Text (MacOS). If the file
is readable then presumably your installer performed the EOL
conversion correctly.
</dd>

<dt class="platformnote">Windows Note:</dt>
<dd>
Make sure that your installer really restores the archive's top-level
directory when it unpacks the distribution. Some installers on Windows
may choose to ignore the archive's top-level directory when the
archive is unpacked. These steps work for me using WinZip:
<ol>
<li>Place the archive in the parent directory that will hold the CM
distribution.</li>
<li>Right-button the archive file and choose <em>Install Here</em>
from the pop-up menu.</li>
</ol>
</dd>
</dl>
</ol>

<h3 id="install_cvs">1.2 Downloading and restoring using
<a href="http://www.loria.fr/~molli/cvs/doc/cvs_toc.html">CVS</a></h3>

<ol>
<li>
Change directories to the directory in which you want to install the
CM source tree.
</li>

<li>
Use anonymous CVS to login to the <a
href="http://sourceforge.net/cvs/?group_id=9766">Sourceforge CVS
repository</a>. Press the return key when prompted for a password.
</li>

<li>Use the CVS <a
href="http://www.loria.fr/~molli/cvs/doc/cvs_16.html#SEC115"><code>checkout</code></a>
command to restore the current CM source tree.
</li>
<li>Once the source tree has been restored to your machine you can
rename the top-level <kbd>cm</kbd> directory if you choose.
</li>
</ol>

<div class="float">
<p class="captxt">
Installing CM sources from the sourceforge CVS repository on OS X and Linux.
</p>
hkt@pinhead:/Lisp [14]% which clisp
/usr/local/bin/clisp
<pre class="shell">% <span class="input">cd /Lisp</span>
% <span class="input">cvs -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/commonmusic login</span>
CVS password: 
% <span class="input">cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/commonmusic checkout cm</span>
<i>[...lots of printout deleted...]</i>
% <span class="input">mv cm cm-2.4.0</span>
</pre>
</div>

<h2 id="start_lisp">2. Starting your Lisp application</h2>

Before building Common Music you must first determine how to start
your Lisp application running. Some Lisp implementations install
a <em>shell command</em> that can be entered in a terminal, or shell
window (the CMD window in Windows) to start Lisp running.  For
example, when you install Clisp on Linux or OS X with the
command <code>make install</code>, a program called
<code>clisp</code> is automatically placed in an appropriate program
directory on the user's command path, for example in /usr/bin or
/usr/local/bin or /sw/bin.

<div class="float">
<p class="captxt">
Clisp's installed program on OS X and Linux.
</p>
<pre class="shell">% <span class="input">which clisp</span>
/usr/local/bin/clisp
%  <span class="input">clisp -q</span>
[1]&gt; <span class="input">(+ 1 2)</span>
3
[2]&gt; <span class="input">(quit)</span>
%
</pre>
</div>
On the other hand, installing Lisp from some binary distributions (for
example the Clisp binary distribiution for Windows) will not
automatically install a shell command to start Lisp.  Even if your
Lisp implementation does NOT come with an installed command you should
create and install one yourself to simplify runngin Lisp inside a
Terminal or Emacs/XEmacs.  There is not one single way to do this that
works for all Lisp implementations and operating systems.  Here are
three different sets of instructions that should cover the most common
cases for people installing Lisp in order to work with Common Music,
CLM and CMN:

<dl>
<dt class="platformnote">Starting CLisp on Windows</dt> 
<dd>
The Clisp program on Windows is called lisp.exe and it is stored in
the full/ subdirectory inside the Clisp distribution folder. To make a
shell command that starts Clisp you will create a Window's <em>batch
file</em> called clisp.bat to start the lisp.exe progam. This file
will then be placed in a directory on your DOS command path.  When you
create the file make sure you use a plain editor like Note Pad or
Emacs to enter the text shown in the example below.  Do not use a word
processor like Word as it may store the file in a .doc format.  Note
that when you enter the example text shown below you will have to
change the actual pathname to lisp.exe so that it is correct for your
file system.  Once you have entered the text, save the file as
clisp.bat and move it to some directory on your command
%path%, for example, to the directory C:\WINNT\WIN32\.

<div class="float">
<p class="captxt">
The contents of the Windows batch file clisp.bat.
</p>
<pre class="shell">@echo off
REM
REM edit the path to lisp.exe to reflect your filesystem.
REM
C:\LISP\CLISP-2.31\FULL\LISP.EXE %1 %2 %3 %4 %5 %6 %7 %8 %9
</pre>
</div>
See foo for more information.
</dd>

<dt class="platformnote">OpenMCL on OS X</dt> 
<dd>
foo fuf.
</dd>

<dt class="platformnote">CMU on Linux</dt> 
<dd>
foo fuf.
</dd>

</dl>

<h2 id="make_cm">3. Building Common Music from sources</h2>

<p>
The following discussion assumes that the CM distribution and other
Lisp software such as CLM and CMN have been restored in separate
directories under a common root Lisp directory. The examples depict
the build process in several different Lisp implementations; if you
use some other Lisp or operating system the examples will appear
slightly differently as you perform each step.
</p>

<ol>
<li>
To build Common Music in its default configuration (highly recommended
for beginners!) start your Lisp and use the <code>load</code> function
to load Common Music's build script from the src/ subdirectory of the
CM installation directory. For Guile Scheme the build script is called
cm.scm, for all other Lisp implementations the file to load is called
cm.lisp.  Be sure to specify the full, true pathname to the file,
i.e. avoid using links, relative paths, or shortcuts like "~/" unless
you are sure your Lisp supports them.
</p>

<div class="float">
<p class="captxt">
Loading the CM build script in OpenMCL/OSX (Common Lisp).
</p>
<pre class="shell">% openmcl
Welcome to OpenMCL Version (Beta: Darwin) 0.13.2!
? <span class="input">(load "/Lisp/cm-2.4.0/src/cm.lisp")</span>
<i>[...lots of printout deleted...]</i></pre>
</div>

<div class="float">
<p class="captxt">
Loading the CM build script in Guile/Linux (Scheme).
</p>
<pre class="shell">% guile
guile&gt; <span class="input">(load "/Lisp/cm-2.4.0/src/cm.scm")</span>
<i>[...lots of printout deleted...]</i></pre>
</div>

<div class="float">
<p class="captxt">
Loading the CM build script in CLisp/Windows (Common Lisp).
</p>
<pre class="shell">&gt; <span class="input">clisp</span>
  i i i i i i i       ooooo    o        ooooooo   ooooo   ooooo
  I I I I I I I      8     8   8           8     8     o  8    8
  I  \ `+' /  I      8         8           8     8        8    8
   \  `-+-'  /       8         8           8      ooooo   8oooo
    `-__|__-'        8         8           8           8  8
        |            8     o   8           8     o     8  8
  ------+------       ooooo    8oooooo  ooo8ooo   ooooo   8

Copyright (c) Bruno Haible, Michael Stoll 1992, 1993
Copyright (c) Bruno Haible, Marcus Daniels 1994-1997
Copyright (c) Bruno Haible, Pierpaolo Bernardi, Sam Steingold 1998
Copyright (c) Bruno Haible, Sam Steingold 1999-2003

[1]&gt; <span class="input">(load "C:\\LISP\\CM-2.4.0\\SRC\\CM.LISP")</span>
<em>[...lots of printout deleted...]</em></pre>
</div>

<dl>
<dt class="platformnote">Windows Note:</dt> 
<dd>
Under the Windows operating system you must <u>double</u> each DOS
directory delimiter when you specify file pathnames as Lisp strings,
i.e.  "C:\\LISP\\" <u>not</u> "C:\LISP\".  This is because a single \
is a special quoting character inside Lisp strings; specifing two
together actually results in one \ character in the string.  If this
is too confusing then you should simply switch to using the Unix-style
directory delimiter /, for example "c:/Lisp/".  ACL, Clisp and Guile
all support unix-style directory strings under Windows.
</dd>
</dl>

<p>
Loading cm.scm into Guile (Scheme) simply loads CM's source files --
no compilation or image saving occurs. In in all other Lisp
implementations loading cm.lisp first <em>compiles</em> source files
into an efficient (binary) representation and then loads them into
Lisp.
</p>

<p>
Once the build process completes, a saved Lisp image file containing
Common Music and supporting runtime files have been saved in CM's
runtime directory, which (by default) is the bin/ subdirectory under
the CM installation directory.
</p>
</li>

<li>
Depending on which Lisp implementation you use, your Lisp may or moy
not automatically exit after the build process has completed.  Even if
your Lisp did not exit automatically you should do so at this point
and then restart Lisp with the freshly saved Common Music application
image as discussed in <a href="#run_cm">Section 4</a>.

<div class="float">
<p class="captxt">
Quitting the build session in CLisp/OSX:
</p>
<pre class="shell"><em>[...lots of printout deleted...]</em>
; Loading /Lisp/cm-2.4.0/bin/cmn.fas.
; Copying application files...
; Removing fasl files.
; Garbage collecting...
; Saving application image.
;; Loaded file /Lisp/cm-2.4.0/src/cm.lisp
T
[2]&gt; <span class="input">(quit)</span>
Bye.
% 
</pre>
</div>
</li>
</ol>

<h3 id="build_scripts">Customized Builds</h3> 
<p>
The build process documented in this section has saved a Common Music
appliation image in the default configuration. To learn about the
various build options, or about how to customize the build process
itself, see the documentation on <a
href="dict/make-cm-fn.html">make-cm</a> for additional information.
</p>

<h2 id="run_cm">4. Running the Common Music application</h2>
<p>
Once the build process completes (see <a href="#make_cm">Section
3</a>) the Common Music image file and supporting runtime files have
been saved in CM's <em>runtime directory</em>, which (by default) is
set to the bin/ subdirectory under the CM installation directory.
</p>

<p>
Here is a brief overview of the runtime directory contents:
</p>

<ul>
<li>
The Common Music image file. Each lisp implemention produces an image
file with a different name so that more one implmentation may be
stored in the same runtime directory. The possible image file names
are:
<ul>
<li>clisp-cm.mem</li>
<li>openmcl-cm.image</li>
<li>cmu-cm.image</li>
<li>acl-cm.dxl</li>
</ul>
</li>

<li>
The <a href="dict/cm-sh-script.html">cm</a> shell script for starting
the Common Music application in a Terminal or Emacs/Xemacs on Linux or
OS X. In Windows this file is called <a
href="dict/cm-bat-script">cm.bat</a>.
</li>

<li>
A lib/ subdirectory containing several runtime files:
<dl>
<dt>lib/cminit.lisp</dt>
<dd>
Automatically loaded each time CM starts up. Put any lisp forms you
want to have evaluated each time you run CM.  If this file already
exists when CM is built the old file will be not overwritten.
</dd>

<dt>lib/listener.el</dt>
<dd>
An Emacs lisp implementation of a dedicated Lisp Listener window for
Emacs/XEmacs. Incldues a menu for Lisp-mode editing for working with
CM inside a lisp-mode edit buffer. See <a href="emacs.html">Working in
Emacs and XEmacs</a> for more information.
</dd>

<dt>lib/cm.el</dt>
<dd>
An Emacs lisp file that defines proper indenting rules for CM, CLM and
CMN definitions.
</dd>
</dl>
</li>

<li>
Implementation specific subdirectories that (may) contain compiled
source files:
<ul>
<li>lib/acl/*.fasl</li>
<li>lib/clisp/*.fas</li>
<li>lib/cmu/*.???</li>
<li>lib/mcl/*.pfasl</li>
<li>lib/opemcl/*.???</li>
</ul>
</li>
</ul>

<h2 id="install_sys">5. Working with CLM, CMN and Midishare</h2>
<p>
To work with either CLM or CLM just load the system into Common Music
using one of the load commands shown below.  If you would like to
build the CM application "prelinked" to one or both of these systems,
load them just prior to building CM.
</p>

<div class="float">
<p class="captxt">
Loading CLM into a running CM image.
</p>
<pre class="shell">
? <span class="input">(load "/Lisp/clm-2/all")</span>
<i>[...lots of printout deleted...]</i></pre>
</div>

<div class="float">
<p class="captxt">
Loading CMN into a running CM image.
</p>
<pre class="shell">? <span class="input">(load "/Lisp/cmn/cmn-all")</span>
<i>[...lots of printout deleted...]</i></pre>
</div>
</li>

<h3 id="install_ms">Installing Midishare</h3>
<p>
A direct connection from Common Music to one or more MIDI Drivers can
be established using <a
href="http://www.grame.fr/MidiShare/">Midishare</a>, a real-time MIDI
operating system developed by <a
href="http://www.grame.fr">Grame</a>. Common Music currently works
with Midishare in the following OS/Lisp combinations:
</p>

<ul>
<li>Linux/CMUCL</li>
<li>OSX/OpenMCL</li>
<li>OSX/MCL 5.0</li>
<li>MacOS 9.2/MCL 4.2, 4.3</li>
</ul>

<p>


Directions for Installing Midishare.
</p>

<ol>

<li>
Download, install and configure the Midishare and Developer packages
from the <a href="ftp://ftp.grame.fr/pub/MidiShare/">Midishare FTP
Server</a>.  Be sure to set up your MidiShare driver ports (msDriver)
and test your MIDI connection (msController) before attempting to
build CM with Midishare.
</li>

<li>
If you are running OpenMCL, download <a
href="ftp://ftp-ccrma.stanford.edu/pub/Lisp/cm/openmcl-midishare.tar.gz">openmcl-midishare.tar.gz</a>
from the CCRMA ftp server and untar the archive in
"ccl/darwin-headers/", i.e. the "darwin-headers/" subdirectory of your
OpenMCL distribution:

<div class="float">
<p class="captxt">
Installing the Midishare FFI in OSX/OpenMCL
</p>
<pre class="shell">% <span class="input">cd /Lisp/ccl/darwin-headers</span>
% <span class="input">tar -zxf openmcl-midishare.tar.gz</span></pre>
</div>
</li>

<li>
If you are running MacOS 9.n, move the shared library "PlayerSharedPPC" from the
developer package into your System Extensions folder.
</li>

<li>
Set the <code>use-midishare</code> build parameter to true and
build the Common Music image as discussed in the <a
href="#build_src">previous section</a> of this document.
</li>

<li>
If you are using OpenMCL or MCL, edit your "bin/cminit.lisp" file and
add the following forms. Be sure to change the absolute pathname
directory strings to match your filesystem first.

<div class="float">
<p class="captxt">
Adding CCL logical host translations to cminit.lisp
</p>
<pre class="code">#+(and <span class="keyword">:mcl :digitool</span>)
(setf (logical-pathname-translations <span class="string">"ccl"</span>)
      `((<span class="string">"**;*.*"   "Macintosh HD:Lisp:MCL 4.2:**:*.*"</span>)))
#+<span class="keyword">:openmcl</span>
(setf (logical-pathname-translations <span class="string">"ccl"</span>)
      `((<span class="string">"**;*.*"   "/Lisp/ccl/**/*.*"</span>)))
</pre>
</div>
</li>
</ol>

</div>

<!-- end content -->

<div id="footer">
<div id="author">H. Taube</div>
<div id="cvs-info">$Name$: $Source$ ($Revision$, $Date$)</div>
</div>



<h4>Where to go next</h4>
<p>
Look at the file in "etc/examples/intro.cm" for an idea of how to work
with CM. Or better yet, buy the book "Notes from the Metalevel" :)
</p>


</body>
</html>
