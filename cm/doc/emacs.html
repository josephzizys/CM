<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1"/>
<style type="text/css" media="all">
@import "css/cm.css";
</style>
<title>Running Common Music under (X)Emacs</title>
</head>

<body>
<!-- Navbar -->
<div id="header">
<div id="logo">
<img src="img/cmlogosw.png" width="50" height="50" alt="[img/cmlogosw.png]" title=""/>
</div>

<div class="inv">Navagation:</div>
<ul class="nav">
<li class="nav1"><a href="cm.html">Home Page</a></li>
<li class="navn"><a href="dict/">Dictionary</a></li>
<li class="navn"><a href="../etc/examples/">Examples</a></li>
</ul>
</div>

<hr class="inv"/>
<div id="content">

<h1>Running Common Music under X/Emacs</h1>

<p>
The <a href="http://www.gnu.org/software/emacs/emacs.html">Emacs</a>
and <a href="http://www.xemacs.org">XEmacs</a> editors (collectively
referred to as X/Emacs in this document) support Lisp editing and
evaluation within a single, consistent GUI environment.  This tight
integration between Lisp editing and evaluation lets the composer
edit Lisp expressions (programs) inside a powerful program
editor and also <em>evaluate</em> the Lisp expressions inside Common
Music using simple editor commands. The Common Music application runs
in its own dedicated Listener window as an <em>inferior process</em>
(sub-process) of X/Emacs. This Listener window is itself a
full-featured, interactive Lisp interpreter with its own command
history and input editing features.
</p>

<p>
The whole point of running Common Music inside X/Emacs is to integrate
Lisp editing and evaluation in a single, easy-to-use graphical
environment. So if your system already has an emacs command installed
on it, make sure that it starts a windowed, GUI version of the
editor!  Some older installations of Emacs run the editor in what is
called <em>console mode</em>, directly inside the command shell window
without a GUI or mouse support.  If your installed Emacs is old (prior
to the 21.3 branch) or doesn't support a GUI then don't bother using
it, simply follow the links provided below to download and install a
newer version for your system.
</p>

<H2>Installing X/Emacs</H2>

<p>
Which editor you choose to install and work with is really a matter of
personal taste.  Both editors are free, provide the same basic editing
services, and run on practically every operating system available
today. The primary difference between the two applications lies in
their divergent GUI designs. Without commenting on which design is
"better", it is probably fair to say that the typical user will feel
most comfortable in an editor whose behavior is consistent with the
host operating system's native window manager. On Linux, Cygwin and
Windows this is XEmacs, on OS X it is probably an <em>Aqua</em> Emacs.
<p>

<h3>Downloading distributions</h3>

<p>
<em>Regardless of which editor you choose, install a recent (21.3.1 or
later), stable, fully-configured distribution that includes all elisp
sources</em>. (X)Eamcs distributions typically consist of several
parts: the core editor, the Emacs Lisp (elisp) source files, and lots
of add-on packages.  The size of a fully configured distribution is
very large, between 20 and 30 megabytes for a binary release depending
on the editor and operating system involved.  Even if downloading will
require up to several hours (on a 56k modem, for example), you should
take whatever time is necessary to install a fully configured X/Emacs
including elisp sources because you will come to use more and more of
its features and add-on packages as you gain familiarity with the
editor.
</p>

<h4>Suggested binary distributions for running Common Music</h4>

<p>
Common Music has been tested in the most recent stable releases of the
following distributions:
</p>

<dl>
<dt>Linux:</dt>
<dd>
<a href="http://www.xemacs.org/Download/index.html">XEmacs for X</a>
</dd>

<dt>OS X:</dt>
<dd>
<a href="http://www.mindlube.com/products/emacs/">Emacs for OS X</a>
(Aqua)
</dd>

<dt>Windows 2000/XP: </dt>
<dd>
<a href="http://www.xemacs.org/Download/win32/">XEmacs for Windows</a>
(Cygwin install also available on the same page.)
</dd>

<dt>MacOS: </dt>
<dd>
MCL's editor (Fred) is an acceptible Emacs substitute. (The name Fred
stands for Fred Resembles Emacs Deliberately.)
</dd>
</dl>

<h3>Customizing X/Emacs</h3>
<p>
Once you have downloaded and installed X/Emacs you can customize it
for working with Common Music and programming in Lisp:
</p>

<ul>
<li>Start X/Emacs</li>

<li>
Select Syntax Highlighting from the Options menu at the top of the
Emacs window.  If Syntax Highlighting has a submenu, make sure that
its Automatic feature is checked in the submenu.
</li>

<li>
Select Save Options from the Options menu. X/Emacs then prompts you to
confirm saving ~/.emacs or ~/.xemacs/init.el.  Type 'y' to confirm.
</li>

<!-- li>Once you have saved the options, quit X/Emacs by selecting
Quit from the File menu, or start learning about the editor using the
interactive Emacs Tutorial located in the Help menu (or via the
keyboard command <b><u>C-h</u> t</b>.)
</li -->
</ul>
</p>

<p>
Saving the customized options creates or updates your personal
<em>emacs initialization file</em> which X/Emacs loads each time it
starts. You can add your own Emacs commands (elisp expressions) to
this file to set up the editor exactly the way you want.  <!-- By
defualt, X/Emacs saves your initialization file in your <em>home
directory</em>. On a Unix-flavor machine, your home directory is your
login directory. On a Windows machine the home directory may be a
login directory or it may be the root directory of the file system,
for example C:\. Regardless of what operating system you use, X/Emacs
lets you specify your home directory using the Unix ~/ convention.
Emacs and XEmacs name the initialization file differently.  --> XEmacs
normally saves the init file as ~/.xemacs/init.el, that is, the file
init.el in the .xemacs/ subdirectory of your home folder. Emacs uses
~/.emacs, the file .emacs located in your home directory. On
Unix-flavored machines (Lunix, OS X, Cygwin, etc) the dotted names
(.xemacs/ and .emacs) make the init files "invisible" in normal
directory listings and file browsing windows.

<!-- The dotted names -- .xemacs/ and .emacs -- make the init file
"invisible" in normal directory listings on Unix machines.  For
example, if you display the content of your home direcotory using
<code>ls ~/</code> on Linux neither .emacs or .xemacs/ will appear in
the listing.  Similarly, OS X these files never appear in the Finder
window.  On Windows, however, the dotted names will be visible in
normal Command Shell listings and in Folder windows -->

</p>

<h3>Learning X/Emacs keyboard commands</h3>

<p>
X/Emacs can be used just like any other mouse-driven, point-and-click
text editor. However, the real power (and beauty) of X/Emacs lies in
its <em>keyboard commands</em>, short, simple keystrokes that invoke
the powerful editing, formatting and cursor moving features of the
editor. X/Emacs keyboard commands are issued by pressing down the
Control and/or Meta keys and then typeing a "command key", a key that
names the command.  The Control key is (usually) the key in the lower
left-hand corner of the keyboard. The Meta key is usually situated
just to the left of the Spacebar. Emacs documentation refers to the
Control and Meta keys using the shorthands <b>C-</b> and <b>M-</b>
respectively. Underlines are sometimes used to
show <em>combinations</em> of keystrokes typed with the Contol and/or
Meta keys depressed. For example:

<ul>
<li>
<b><u>C-h</u></b> means to hold down the Control key while you type
the 'h' key.
</li>

<li>
<b><u>M-x</u></b> means to hold down the Meta key while you type 'x'.
</li>

<li>
<b><u>C-M-f</u></b> means to hold down both Control and Meta while you
type 'f'.
</li>

<li>
<b><u>C-h</u> t</b> means to first type <b><u>C-h</u></b>, then
release the keys and type just the 't' key.
</li>

<li>
<b><u>M-x</u> lisp-mode</b> means to hold down Meta and type the 'x'
key, then release both keys and type the word 'lisp-mode'.
</li>

</ul>

<p>
<em>In order to become an efficient X/Emacs Lisp composer you should
spend several hours familiarizing yourself with X/Emacs keyboard
commands and the editing features of the appliction</em>. 
</p>

<p>Here are some places you can start:</p>

<ul>

<li>
Perform the interactive Emacs Tutorial, available from the Emacs Help
menu or by typing the command <b><u>C-h</u> t</b>
</li>

<li>
<a href="http://www.xemacs.org/Documentation/21.5/html/new-users-guide.html">
Getting Started With XEmacs</a>
</li>

<li>
<a href="http://www.gnu.org/software/emacs/manual/html_chapter/emacs_toc.html">
The Emacs Manual</a>
</li>

<li>
<a href="http://www.gnu.org/software/emacs/elisp-manual/html_chapter/elisp.html#SEC_Top">
The GNU Emacs Lisp Reference Manual</a>
</li>
</ul>

<p>
See Lisp Editing and Evaluation for more information.
</p>

<h2>Running Common Music under X/Emacs</h2>

<p>
The remainng sections of this document assume that you have already
downloaded Common Music and can start a GUI X/Emacs on your
system. See the document <a href="install.html">Installing Common
Music</a> for more information about downloading and installing CM.
</p>

<h3>Quickstart (Linux, OS X, Cygwin)</h3>

<p>

The easiest way to start CM under X/Emacs is to pass your favorite
editor command to the bin/cm.sh script.  Here are several examples on
different systems. Each example assumes that you have
already <code>cd</code>'ed to the Common Music installation directory:
</p>

<div class="float">
<p class="captxt">Starting CM under xemacs on Linux:</p>
<pre class="shell">% <span class="input">bin/cm.sh -e xemacs</span></pre>
</div>

<div class="float">
<p class="captxt">Starting CM under /Application/Emacs on OS X:</p>
<pre class="shell">% <span class="input">bin/cm.sh -e Emacs</span></pre>
</div>

<div class="float">
<p class="captxt">Starting CM in Guile under Emacs on Cygwin:</p>
<pre class="shell">$ <span class="input">bin/cm.sh -l guile -e emacs</span></pre>
</div>

<p>
See the <a href="dict/cm-sh.html"><code>cm.sh</code> documentation</a>
for more information about using the script to run Common Music.
</p>

<h3>Running CM in X/Emacs under Windows</h3>

<p>
You cannot use cm.sh in the Windows command interpreter (CMD).
However, you can add code to your X/Emacs init file that will
accomplish bascially the same thing. These instructions are outlined
in the next section <a href="#cm-emacs-initfile">Starting Common Music
from inside X/Emacs</a>.
</p>

<!--
The following instructions assume
that the file cm.bat was created in the bin/ subdirectory of the
Common Music installation directory when you installed CM.

<ol>
<li>
Use the Windows command interpreter to verify that you can start CM
running with the cm.bat file:

<ol>
<li>
Select Run Command from the Start menu, or type Windows-R (press
Windows key down and type R).
</li>

<li>Enter <code>CMD</code> in the Run dialog's typein box and then
click on OK.</li>

<li>
Select the shell window, <code>cd</code> to the bin/ subdirectory and
type <code>cm</code> to insure that Common Music starts running inside
the command shell. Once you have verified that CM starts up,
type <code>(quit)</code> to quit Lisp and return to the CMD prompt and
then close the shell window.


<div class="float">
<p class="captxt">Verifying that cm.bat works in the Windows CMD
shell:</p>
<pre class="shell">[C:\]  <span class="input">cd \Lisp\cm-2.4.\bin</span>
C:\Lisp\cm-2.4.1\:  <span class="input">cm</span>

 /\\\          
---\\\---------
----\\\--------
----/\\\------- Common Music 2.4.1
---/--\\\------
--/----\\\-----
 /      \\\/   

[1]> <span class="input">(quit)</span>

[C:\Lisp\cm-24.1\bin]</pre>
</div>
</li>
</ol>

</li>

<li>
Follow the instructions in <a href="#cm-emacs-initfile">Starting
Common Music from inside X/Emacs</a>.
</li>
</ol>
-->
<h3 id="cm-emacs-initfile">Starting Common Music from inside X/Emacs</h3>

You can start Common Music from inside a running X/Emacs session if
you first customize your X/Emacs init file to load the necessary
support code. The example shown belows is set up for installing this
on a Windows machine.

<!--  Here is how to start Common Music from within a running
X/Emacs on Windows.
 (To use it on a Unix-flavored machine simply
change the file name "cm.bat" to "cm.sh".)
-->

<ol>

<li>
Add the following forms to your X/Emacs init file.  Be sure to change
the value of <code>cm-pathname</code> to the true directory path to
the Common Music installation directory on your machine.  Use the Unix
directory delimiter / in the pathname even if you are on Windows.  If
you are <em>not</em> on Windows then change the name of
the <code>cm-startfile</code> from cm.bat to cm.sh.

<div class="float">
<p class="captxt">Loading CM's listener into X/Emacs on Windows.
</p>
<pre class="code"><span style="color: blue;">;;; Edit the cm-directory string to point to the
;;; CM installation directory on your machine.
;;; On unix machines change cm.bat to cm.sh
</span>
(<span class="special">defvar</span> <span class="defined">cm-directory</span> <span class="string">"C:/Lisp/cm-2.4.1"</span>)

(<span class="special">defvar</span> <span class="defined">cm-startfile</span> <span class="string">"cm.bat"</span>)

(<span class="special">let*</span> ((els (concat cm-directory <span class="string">"/etc/xemacs"</span>))
       (bin (concat cm-directory <span class="string">"/bin/"</span>
                    cm-startfile))
       (load-path (cons els load-path)))
  (load <span class="string">"listener"</span>)
  (load <span class="string">"cm"</span>)
  (setq inferior-lisp-program bin))</pre>
</div>
</li>

<li>
Save the changes (<b><u>C-x</u></b> <b><u>C-s</u></b>) and quit X/Emacs
 (<b><u>C-x</u></b> <b><u>C-c</u></b>).
</li>

<li>
Restart X/Emacs, then type <b><u>C-x</u> l</b> to start Common Music's
Listener window. Alternately, you can set the current buffer into
Lisp-mode (<b><u>M-x</u> lisp-mode</b>) and then select Lisp Listener
from the Listener menu that appears in the X/Emacs menu bar.
</li>
</ol>

<h2>The X/Emacs Lisp Listener </h2>

The Lisp Listener runs Common Music in a dedicated
X/Emacs <em>frame</em> or window, as a subprocess of the editor. THis
meas when you quit the editor you will also quit the Common Music
session running in the Listener.

There are two aspects to the Listener, the Listener window itself and
the Listener menu that automatically appears whenever you edit a
.lisp, .cm or .ins text file.  This menu is actually part of the
<a href="">Lisp edit mode</a> that supports Lisp programm editing in
X/Emacs.
<h3>The Listener menu</h3>

<h3>The Listener Window</h3>

<h3 id="lisp_mode_cmds">Overview of Lisp-mode editing commands.</h3>


<h2>X/Emacs Tips </h2>

<h3>Adding Apple Keyboard Commands to OS X/Emacs</h3>




</div> <!-- end content -->
<div id="footer">
<div id="author">H. Taube</div>
<div id="cvs-info">$Name$: $Source$ ($Revision$, $Date$)</div>
</div>
</body>
</html>




</body>
