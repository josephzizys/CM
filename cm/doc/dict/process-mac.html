<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1"/>
<style type="text/css" media="all">
@import "../css/cm.css";
</style>
<title>process</title>
</head>
<body>
<div id="content">


<!-- Entry: "process" -->
<dl class="dictsyntax">
<dt>[Macro]</dt>
<dd><span class="syntax">(<code class="entry">process</code> {<var>clause</var>}+)</span></dd>
</dl>


<p>
The <kbd>process</kbd> macro supports iterative process description
using the same syntax as Lisp's <kbd>loop</kbd>
macro. <kbd>process</kbd> iteration is defined as a series of clauses,
each clause begins with a clause operator.  There are four broad
categories of clause operators:
</p>

<ul>
<li>Initialization and Finalization
    <ul>
    <li> <a href="#with.clause"><kbd>with</kbd></a> declares and initializes local process variables. </li>
    <li> <a href="#initially.clause"><kbd>initially</kbd></a> performs an action before iteration starts. </li>
    <li> <a href="#finally.clause"><kbd>finally</kbd></a> performs a final action immediately after process stops. </li>
    </ul>
</li>

<li>Iteration
<ul>
<li> <a href="#repeat.clause"><kbd>repeat</kbd></a> sets the number of times the process runs. </li>
<li> <a href="#for.clause"><kbd>for</kbd></a> defines a variable over a range of values, stops process when done. </li>
</ul>
</li>

<li>Actions
<ul>
<li><a href="#do.clause"><kbd>do</kbd></a> evaluates one or more Lisp statements.</li>
<li><a href="#each.clause"><kbd>each</kbd></a> iterates action clause.</li>
<li><a href="#output.clause"><kbd>output</kbd></a> outputs an event into the open output stream. </li>
<li><a href="#sprout.clause"><kbd>sprout</kbd></a> inserts a new object into the scheduling queue. </li>
<li><a href="#wait.clause"><kbd>wait</kbd></a> process waits a specified amount of time before running again. </li>
</ul>
</li>

<li>Conditionalization
<ul>
<li><a href="#while.clause"><kbd>while</kbd></a> evaluates an action if a test is true or stops the process if false. </li>
<li><a href="#until.clause"><kbd>until</kbd></a> evaluates an action if a test is or stops the process if true. </li>
<li><a href="#when.clause"><kbd>when</kbd></a> evaluates an action if a test is true. </li>
<li><a href="#unless.clause"><kbd>unless</kbd></a> evaluates an action if a test is false. </li>
<li><a href="#if.clause"><kbd>if</kbd></a> evaluates one or more "then" or "else" actions based on a test.  </li>
</ul>
</li>
</ul>

<p>
Iteration and action clauses are executed in the same order in which
they appear in the code.  If more than one iteration clause is
specified the process terminates as soon as the earliest clause
completes its iteration.
</p>

<p><strong>Initialization and Finalization Clauses</strong>
</p>
<dl>


<dt><code>with</code> <var>var</var> [<code>=</code> <var>form</var>] {<code>and</code> <var>var2</var> [<code>=</code> <var>form2</var>]}*</dt>
<dd>

<a name="with.clause"></a>
Declares local process variables and their optional initial values. The
forms in a <kbd>with</kbd> clause are processed one time only immediately
before process iteration starts.

Each variable declaration in the <kbd>with</kbd> clause
can be specified as either:
<ul>
<li>the name of the variable.</li>
<li>the name of the variable and an initial value separated by <kbd>=</kbd>. </li>
</ul>

If an initial value is not specified a variable is initialized to false.
Use <kbd>and</kbd> to separate variables if more than one variable is declared.
Declarations are processed in left to right order
so a <kbd>=</kbd> value may reference variables declared to the left.
<br/>Example clause syntax:
  <blockquote>
  <pre>with a and b = 32 and c = (* (random b) 4)
</pre></blockquote>
</dd>



<dt><code>initially</code> <var>form</var></dt>
<dd>

<a name="initially.clause"></a>
Evaluates <var>form</var> when the process is created and before the process starts running.
<br/>Example clause syntax:
<blockquote>
<pre>initially (print 'initializing!)
</pre></blockquote>
</dd>


<dt><code>finally</code> <var>form</var></dt>
<dd>

<a name="finally.clause"></a>
Evaluates <var>form</var> immediately after the process stops.
<br/>Example clause syntax:
<blockquote>
<pre>do ...
finally (print 'all-done!)
</pre></blockquote>
</dd>

</dl>



<p><strong>Iteration Clauses</strong>
</p>
<dl>


<dt><code>repeat</code> <var>form</var></dt>
<dd>

<a name="repeat.clause"></a>
Causes the process to run <var>form</var> number of times and then
<a href="#stop.function">stop</a>. 
<br/>Example clause syntax:
<blockquote>
<pre>repeat 23
</pre></blockquote>
</dd>


<dt><code>for</code> <var>var</var> <code>=</code> <var>form</var> [<code>then</code> <var>form2</var>]</dt>
<dd>

<a name="for.clause"></a>
Sets <var>var</var> to the value of <var>form</var> on each iteration.
If <kbd>then</kbd> is supplied <var>var</var> is set to <var>form</var> 
on the first iteration and to <var>form2</var> on subsequent iterations.
<br/>Example clause syntax:
<blockquote>
<pre>for k = (now)
for p = 60 then (+ p (random 10))
</pre></blockquote>
</dd>


<dt><code>for</code> <var>var</var> [<code>from</code> <var>form</var>] [<code>to</code> | <code>below</code> <var>form</var>] [<code>by</code> <var>form</var>]</dt>
<dd>

Iterates <var>var</var> over a range of numbers. If the sequence is bounded
the process <a href="#stop.function">stops</a> once the last number has been reached.

<ul>
<li><kbd>from</kbd> sets the starting value of<var>var</var>, defaults to 0.</li>
<li><kbd>to</kbd> establishes an inclusive ceiling on the iteration and stops
the process once the value has been reached. </li>
<li><kbd>below</kbd> sets an exclusive ceiling on the iteration and stops
the process just before the value has been reached.</li>
<li><kbd>by</kbd> provides an optional increment for <var>var</var>, defaults to 1.</li>
</ul>

<br/>Example clause syntax:
<blockquote>
<pre>for k below 10
for p from 10 to 100 by 5 
</pre></blockquote>
</dd>


<dt><code>for</code> <var>var</var> {<code>in</code> | <code>on</code>} <var>list</var> [<code>by</code> <var>function</var>]</dt>
<dd>

Sets <var>var</var> to successive elements or tails of <var>list</var> and
<a href="#stop.function">stops</a> process when iteration is done.

<ul>
<li><kbd>in</kbd> maps <var>var</var> over successive elements in <var>list</var>.</li> 
<li><kbd>on</kbd> maps <var>var</var> over successive tails of <var>list</var>.</li>
<li><kbd>by</kbd> specifies an optional stepping function. Defaults to <kbd>cdr</kbd>.</li>
</ul>

<br/>Example clause syntax:
<blockquote>
<pre>for k in '(c4 d4 ef5 fs)
</pre></blockquote>
</dd>

</dl>


<p><strong>Action Clauses</strong>
</p>
<dl>


<dt><code>output</code> <var>object</var> [<code>to</code> <var>io</var>]</dt>
<dd>

<a name="output.clause"></a>
Outputs <var>object</var> to an open output stream. If <kbd>to</kbd> is is not specified
the default open output stream is used.
The Lisp function <a href="#output.function"><kbd>output</kbd></a> is available
for use inside a <kbd>do</kbd> clause definition.
</dd>


<dt><code>wait</code> <var>seconds</var></dt>
<dd>

<a name="wait.clause"></a>
Causes the process to wait <var>seconds</var> amount of time before running again.
The Lisp function <a href="#wait.function"><kbd>wait</kbd></a> is available
for use inside a <kbd>do</kbd> clause definition.
</dd>


<a name="sprout.clause"></a>
<dt><code>sprout</code> <var>object</var> [<code>at</code> <var>time</var>]</dt>
<dd>

<a name="wait.clause"></a>
Inserts <var>object</var> into the currently running scheduling queue
<kbd>at</kbd> an optional time. If the <kbd>at</kbd> time is not specified
the object is inserted at the current time.
The Lisp function <a href="#sprout.function"><kbd>sprout</kbd></a> is available
for use inside a <kbd>do</kbd> clause definition.
</dd>


<dt><code>do</code> {<var>form</var>}+</dt>
<dd>

<a name="do.clause"></a>
Introduces one or more Lisp <var>forms</var> as part of the process definition.
</dd>



<dt><code>set</code> <var>var</var> <var>=</var> <var>form</var></dt>
<dd>

<a name="set.clause"></a>
Sets the variable <var>var</var> to the value of <var>form</var>. Set only sets the variable, i.e. it
does not actually declare or bind the variable in the process.
</dd>


<dt><code>each</code> <var>var</var> {<code>in</code> | <code>from</code>} <var>form</var> [<code>as</code> <var>...</var>] <var>action</var></dt>
<dd>

<a name="each.clause"></a>
Defines an iteration over the <var>action</var> clause. <kbd>Each</kbd> supports the same stepping clauses 
that <kbd>for</kbd> does. The difference between <kbd>for</kbd> and <kbd>each</kbd> is that the
former defines a process iteration while <kbd>each</kbd> 
defines an iterative action inside the process.  The following
two clause descriptions are equivalent:

<blockquote>
<pre>each i in lst output ...
do (loop for i in lst do (output ...))</pre>
</blockquote>
</dd>

</dl>



<p><strong>Conditional Clauses</strong>
</p>
<dl>



<dt><code>while</code> <var>test</var> <var>action</var></dt>
<dd>

<a name="while.clause"></a>
Triggers <var>action</var> clause as long as <var>test</var> is true otherwise <a href="#stop.function">stops</a> process.
<br/>Example clause syntax:

<blockquote>
<pre>while (< (now) end-time)
do ...
</pre></blockquote>
</dd>


<dt><code>until</code> <var>test</var> <var>action</var></dt>
<dd>

<a name="until.clause"></a>
Triggers <var>action</var> clause as long as <var>test</var> is false otherwise <a href="#stop.function">stops</a> process.
<br/>Example clause syntax:
<blockquote>
<pre>until (= freq 440)
do ...
</pre></blockquote>
</dd>


<dt><code>when</code> <var>test</var> <var>action</var></dt>
<dd>

<a name="when.clause"></a>
Triggers <var>action</var> clause whenever <var>test</var> is true. 
</dd>


<dt><code>unless</code> <var>test</var> <var>action</var></dt>
<dd>

<a name="unless.clause"></a>
Triggers <var>action</var> clause whenever <var>test</var> is false. 
</dd>


<dt><code>if</code> <var>test</var> [<var>action</var> {<code>and</code> <var>action</var>}*] [<code>else</code> <var>action</var> {<code>and</code> <var>action</var>}*]</dt>
<dd>

<a name="if.clause"></a>
Triggers one or more <var>action</var> clauses if <var>test</var> is true otherwise triggers
one or more optional <kbd>else</kbd> action clauses.
</dd>


</dl>


The file <a href="../../etc/examples/intro.cm">intro.cm</a>
contains many examples of <kbd>process</kbd>.


</div>
<hr class="inv"/>

<!-- Footer -->
<div id="footer">
<div id="version">$Name$</div>
<div id="cvs-info">($Revision$, $Date$)</div>
</div>
</body>
</html>


