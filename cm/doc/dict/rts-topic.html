<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1"/>
<style type="text/css" media="all">
@import "../css/cm.css";
</style>
<title>rts</title>
</head>

<body>
<div id="content"> <!-- begin content -->
<dl class="dictsyntax">
<dt>[Topic]</dt>
<span class="syntax">RTS</span></dd>
</dl>

<p>Support for Real time Scheduling (RTS) is available for the following
Lisp implementations:
</p>

<ul>
<li>Gauche Scheme</li>
<li>SBCL/Linux</li>
<li>OpenMCL/OS X</li>
</ul>

<p> To enable RTS in Common Lisp do:</p>

<blockquote>
<pre>(<a href="use-system-fn.html">use-system</a> <span class="keyword">:rts</span>)</pre>
</blockquote>

<p>Support is automatically loaded in Gauche Scheme.</p>

<h4>Implementation</h4>


<p>Loading the RTS system adds the following set of features to Common Music:
</p>
<ul>
<li>Real time scheduling.</li>
<li>Setting receive hooks in real time streams.</li>
<li>Socket support for reading and writing OSC messages.</li>
<li>The osc-stream and sc-stream classes.</li>
</ul>




<p> The <a href="rts-fn.html"><code>rts</code></a> scheduler is source
compatible with <a href="events-fn.html"><code>events</code></a>,
which means that the same <a
href="process-mac.html"><code>process</code></a> definition can run in
both environments.  The most visible differences between the two
schedulers are:<!-- <code>rts</code> and <a
href="events-fn.html">events</a> (aside from the obvious real time
scheduling aspect) are: -->

<ul> <li>the REPL is not blocked by <a
href="rts-fn.html"><code>rts</code></a> while the scheduler is
running.  </li>

<li> <a href="rts-fn.html"><code>rts</code></a> continues to run until it is
explicitly stopped, even if its queue is empty.  </li>

<li> <a
href="sprout-fn.html">sprout</a> is called interactively from the REPL
or from a <a href="receive-fn.html">receive hook</a> to add objects to
<code>rts</code>.  </li> <li>Values returned by <a
href="now-fn.html">now</a> under RTS reflect the current real time in
seconds.</li> </ul>

<p> Although process definitions do not have to be changed to run
under <code>rts</code>, real time scheduling does place timing demands
on software that non-real time scheduling does not. For example,
process definitions should avoid consing and creating lots of
temporary structure or being otherwise wasteful and inefficient.
Consider reusing events rather than creating new one for each output
statement.  If you are working with MIDI, consider using low-level,
consless <a href="midi-topic.html#midi_messages">MIDI messages</a> in
place of <a href="midi-cls.html">midi</a> objects.  </p>

<p> CM uses posix threads or an implementation specific
mechanism to implement <code>rts</code>. The availability of either
method depends on the underlying Lisp implementation. </p>

<h4>Limitations</h4>

<ol>
<!-- li>Both threaded and periodic versions of <code>rts</code> are
supported in OpenMCL and SBCL.  The default implementation is
threaded. To try out the periodic version set <code>*rts-type*</code>
to <code class="keyword">:periodic</code>.
</li -->

<!-- li>Periodic polling has several consequences:
</p>  
<ul>
<li>Using the GUI at the same time as periodic rts or periodic
receiving will currently not work.</li>
<li>Periodic tasks are pushed onto a task list; if <code>rts</code> is
periodic be sure to start it running before
calling <a href="set-receiver-fn.html">set-receiver!</a>
otherwise <code>rts</code> will not be able to process what the
receiver places into its queue until the next tick.</li>
<li>All receiving and process tasks must happen within the 1
millisecond tick or things will drift.
</li>
</ul>

</li -->

<li>SBCL/Linux: If you use RTS with Portmidi, do not load the RTS
system until after you have opened a Portmidi connection. If you load
RTS before you open Portmidi then SBCL segfaults. I don't know why
this happens.</li>

<li>
How accurate RTS timing is depends on a number of factors, including
how accurate the Lisp implementation's thread sleeping/periodic tasks
are, how short the time deltas between musical events are, whether
process code is compiled or interpreted, how much garbage is
generated, and so on.
</li>
</ol>


<h4>See also:</h4>
<ul>

<li><a href="rts-fn.html"><code>rts</code></a> [Function]</li>

<li><a href="set-receiver-fn.html"><code>set-receiver!</code></a> [Function]</li>

</ul>

</div> <!-- end content -->
<hr class="inv"/>
<!-- Rtster -->
<div id="rtster">
<div id="version">$Name$</div>
<div id="cvs-info">($Revision$, $Date$)</div>
</div>
</body>
</html>
