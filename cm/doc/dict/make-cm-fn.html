<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1"/>
<style type="text/css" media="all">
@import "../css/cm.css";
</style>
<title>make-cm</title>
</head>
<body>
<div id="content">


<!-- Entry: "make-cm" -->
<dl class="dictsyntax">
<dt>[Function]</dt>
<dd><span class="syntax">(<code class="entry">make-cm</code> 
[<code class="keyword">:prompt</code> <var>bool</var>] 
[<code class="keyword">:run-directory</code> <var>dir</var>] 
[<code class="keyword">:scheme</code> <var>bool</var>]
[<code class="keyword">:save-image</code> <var>bool</var>] 
[<code class="keyword">:delete-fasls</code> <var>bool</var>] 
[<code class="keyword">:run-command</code> <var>string</var>] 
[<code class="keyword">:force</code> <var>bool</var>])</span></dd>
</dl>


<p>
Compiles, loads and saves the Common Music application according to 
its keyword build parameters.  This function is called automatically
if you build Common Music in its default configuration by loading the file
<a href="../../src/cm.lisp">src/cm.lisp</a>.
To customize the build process, or to enable interactive prompting for each
build parameter during the make process, load the file
<a href="../../src/make.lisp">src/make.lisp</a> and
call <code>make-cm</code> by hand.

</p>
<p><code class="entry">make-cm</code> supports the following keyword build parameters:
</p>


<dl>

<dt><code class="keyword">:prompt</code> {<var>true</var> |
<var>false</var>}</dt>
<dd>
If <var>true</var> then the user is interactively prompted for any
build parameter not specified to the function. If the value is
<var>false</var> then the system is built without any prompting.  The
default value is <var>false</var>.
</dd>

<dt><code class="keyword">:run-directory</code> {<var>string</var> |
<var>true</var> | <var>false</var>}</dt>
<dd>
The full pathname to the directory where the compiled files, the
Common Music image file, and runtime files will be saved. You must
have write permission in this directory. If the value is
<var>false</var> (or if you do not have write permission in the run
directory) then no compilation or image saving will occur but source
files will still be loaded.  If the value is <var>true</var> or if the
build parameter is not specified then the run directory is set to the
bin/ subdirectory in the Common Music installation directory.  The
default value is <var>true</var>.
</dd>

<dt><code class="keyword">:scheme</code> {<var>true</var> |
<var>false</var>}</dt>
<dd>
If <var>true</var> then Scheme syntax is enabled in Common Lisp, if
<var>false</var> it is not. The default value is <var>true</var>.
</dd>

<dt><code class="keyword">:save-image</code> {<var>true</var> |
<var>false</var> | :if-no-compile}</dt>
<dd>
If <var>true</var> then the Common Music application is saved as a
lisp image file.  If the value is <code>:if-no-compile</code> than an
image is saved only if no source files are compiled during the make
pass. If the value is <var>false</var> then no image file is
saved. The default value is <var>true</var>.
</dd>

<dt><code class="keyword">:delete-fasls</code> {<var>true</var> |
<var>false</var>}</dt>
<dd>
If <var>true</var> then compiled files are deleted after an image has
been saved otherwise they are not.  The default value is
<var>true</var>.
</dd>

<!--  
<dt><code class="keyword">:make-file</code> {<var>string</var> |
<var>true</var> | <var>false</var>}</dt>
<dd>
A string name or pathname for saving a make-script to rebuild the
application using current build parameter values. If the value is
<var>true</var> then the file "makecm.lisp" is saved in the lib/
subdirectory of the run directory. If the value is <var>false</var>
then no make file is saved.
</dd>
-->

<dt><code class="keyword">:run-command</code> {<var>string</var> |
<var>true</var> | <var>false</var>}</dt>
<dd>
A string name or pathname to save a command script that starts the CM
application running inside <a href="../emacs.html">Emacs or XEmacs</a>,
or a terminal if neither editor can be located. If the value is
<var>true</var> then the shell script is named <a
href="cm-script.html">cm</a> and saved in the run directory. If the
value is <var>false</var> then no script file is saved.
</dd>

<dt><code class="keyword">:force</code> {<var>true</var> |
<var>false</var>}</dt>
<dd>
Determines what to do if <code>make-cm</code> is called in a Lisp
environment that already contains Common Music. If the value is
<var>true</var> then the function will rebuild CM even though it is
already loaded. If the value is <var>false</var> then the function
returns without doing anything. The default value is <var>false</var>.
</dd>

</dl>

<!-- Examples -->
<h4>Examples:</h4>


<!-- Interaction -->
<div class="float" >
<p class="captxt">Build Common Music in its default configuration.</p>
<pre class="shell">&gt; <span class="input">(load "/Lisp/cm-2.4.0/src/cm.lisp")</span>
; Compiling /Lisp/cm-2.4.0/src/clm-stubs.lisp.
; Loading /Lisp/cm-2.4.0/bin/clm-stubs.pfsl.
<em>[...build output deleted...]</em>
; Saving start-up script '/Lisp/cm-2.4.0/bin/cm'.
; Copying application files...
; Garbage collecting...
</pre>
</div>

<!-- Interaction -->
<div class="float" >
<p class="captxt">Build using custom run directory and not deleting compiled files 
 after image save.</p>
<pre class="shell">&gt; <span class="input">(load "/Lisp/cm-2.4.0/src/make.lisp")</span>
#P"/Lisp/cm-2.4.0/src/make.lisp"
&gt; <span class="input">(make-cm :run-directory "/Lisp/bin/cm" :delete-fasls nil)</span>
; Compiling /Lisp/cm-2.4.0/src/clm-stubs.lisp.
; Loading /Lisp/bin/cm-2.4.0/clm-stubs.pfsl.
<em>[...build output deleted...]</em>
; Saving start-up script '/Lisp/bin/cm-2.4.0/cm'.
; Copying application files...
; Garbage collecting...
</pre>
</div>

<!-- Interaction -->
<div class="float" >
<p class="captxt">Build using interactive prompting.</p>
<pre class="shell">&gt; <span class="input">(load "/Lisp/cm-2.4.0/src/make.lisp")</span>
#P"/Lisp/cm-2.4.0/src/make.lisp"
&gt; <span class="input">(make-cm :prompt t)</span>
Making Common Music from '/Lisp/cm-2.4.0/'.
Type '?' for help, '^' to abort and
Return to accept defaults shown in [].

Runtime directory: [/Lisp/cm-2.4.0/bin/] <span class="input">?</span>
Type the full pathname to the directory that you want
compiled files, the Common Music image file, and runtime
files to be saved in. You must have write permission in
this directory.
Runtime directory: [/Lisp/cm-2.4.0/bin/] 
Include Scheme compatibility? (Y/N): [Y] 
Save CM image file? (Y/N/:if-no-compile): [Y] 
Delete compiled files after saving image?: [Y] <span class="input">n</span>
Save shell command to start CM application? (Y/N/file): [Y] 
Making Common Music with build parameters:
  :run-directory "/Lisp/cm-2.4.0/bin/"
  :scheme t
  :save-image t
  :delete-fasls nil
  :run-command t

Are these values correct? (Y/N): <span class="input">y</span>

; Compiling /Lisp/cm-2.4.0/src/clm-stubs.lisp.
; Loading /Lisp/cm-2.4.0/bin:/clm-stubs.pfsl.
<em>[...build output deleted...]</em>
; Saving start-up script '/Lisp/cm-2.4.0/bin/cm'.
; Copying application files...
; Garbage collecting...
</pre>
</div>


<!-- See also -->
<h4>See Also:</h4>
<ul>
<li><a href="cm-sh-script.html"><kbd>cm</kbd></a><kbd>&nbsp;</kbd>[Script]</li>
</ul>
</div>
<hr class="inv"/>

<!-- Footer -->
<div id="footer">
<div id="version">$Name$</div>
<div id="cvs-info">($Revision$, $Date$)</div>
</div>
</body>
</html>


