<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html
xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> <head>
<meta http-equiv="content-type" content="text/html;
charset=iso-8859-1"/> <style type="text/css" media="all"> @import
"grace.css"; </style> <title>The Console Window</title> </head> <body>
<div id="content">

<h1>Installing and Running Grace</h1>

  <ul>
    <!-- li><a href="#requirements">Requirements</a></li -->
    <li><a href="#introduction">Introduction </a></li>    
    <li><a href="#svn">Downloading Sources (SVN) </a></li>
    <li><a href="#compiling">Compiling Sources</a>
    <li><a href="#premake">Creating Custom Build Scipts with premake</a>
    <li><a href="#installing">Installing Runtime Resources</a></li>
    <li><a href="#grace">Running Grace</a>
    <li><a href="#gracecl">Running GraceCL</a>
    <li><a href="#starting">Starting Grace from the Command Line</a></li>
    <li><a href="#options">Command Line Options</a></li>
    <li><a href="#appendix">Appendix</a>
    <ul>
      <li><a href="#juce">Installing JUCE</a>
      <ul>
	<li><a href="#juce_linux">Installing JUCE on Linux</a></li>
	<li><a href="#juce_osx">Installing JUCE on OS X</a></li>
      </ul>
      </li>
      <li><a href="#chicken">Installing Chicken Scheme</a></li>
      <!-- li><a href="#building_binary">Building a binary release of Grace</a></li -->
    </ul>
</li>
</ul>

<h2>Introduction</h2>

<p>The Grace source tree contains source code for building two different applications, Grace and GraceCl, each of which runs three operating systems: Linux, MacOSX and Windows.

<ul>
<li><a href="scheme.html">Grace</a> is a realtime algorithmic composition enviroment using Chicken Scheme as its extension language.</li>
<li>GraceCL is a non-realtime algorithmic composition enviroment using Common Lisp as its extension language for working with systems like CM CLM and FOMUS.<li>
</ul>


<!-- h2 id="requirements">Requirements</h2>

<p>Installing Grace from its sources requires the following software systems:</p>

<ul>
  <li><a href="http://subversion.tigris.org/">Subversion</a></li>
  <li><a href="http://www.rawmaterialsoftware.com/juce/">JUCE</a> </li>
  <li><a href="http://www.call-with-current-continuation.org/">Chicken Scheme</a> if you are building Grace with real time scheduling.</li>
  <li><a href="http://sbcl.sourceforge.net/platform-table.html">SBCL</a> or <a href="http://sourceforge.net/project/showfiles.php?group_id=1355">CLisp</a> if you are building Grace with Common Lisp (Common Music, CLM, etc)</li>
  <li>Optional: <a href="http://premake.sourceforge.net/">premake</a></li>
</ul -->

<h2 id="svn">Downloading Sources (SVN)</h2> <p>Use
<code>svn</code> to download the Grace source tree. Use your favorite
SVN client or type the following command in the Terminal (all on one
line): </p>

<blockquote>
<pre class="code">
$ svn co http://commonmusic.svn.sf.net/svnroot/commonmusic/trunk/grace grace</pre>
</blockquote>

<h2 id="compiling">Compiling Sources</h2>

<p>The grace/build directory contains scripts and project files for building Grace and GraceCL on Linux, OS X, and Windows:
</p>

<div class="float">
<table width="85%">
  <!-- caption>Build directions for Grace and GraceCL</caption -->
  <tr><th ></th><th style="text-align: left;"> Linux </th> <th style="text-align: left;"> OS X</th> <th style="text-align: left;"> Windows/mingw </th> </tr>
  <tr><th style="text-align: left;"> Grace </th>
  <td >
    <a href="#grace-linux">Makefile</a>
  </td >
  <td style="text-align: left;">
    <a href="#grace-macosx">XCode</a> 
  </td>
  <td style="text-align: left;">
    <a href="#grace-windows">CodeBlocks</a> <sup>1</sup>
  </td>
</tr>
  <tr><th style="text-align: left;"> GraceCL </th>
  <td>
    <a href="#gracecl-linux">Makefile</a>
  </td >
  <td>
    <a href="#gracecl-macosx">XCode</a>
  </td>
  <td>
    <a href="#gracecl-windows">CodeBlocks</a>
  </td>
</tr>
</table>

<p style="font-size: smaller;">
1. <a href="http://forums.codeblocks.org/index.php?PHPSESSID=ac8b426f522b6aad04468cd60a8dadb2&topic=7717.0">Codeblocks svn 4853</a> (download the dlls for WxWidgets and Mingw on the same page)
<br/>
<!-- 2. <a href="http://developer.apple.com/tools/download/">XCode 3.0</a> -->
</p>

</div>

<p>TheBy default the various build scripts assume that the <code>grace</code>,
<code>juce</code> and <code>chicken</code> installation directories
 reside within a common parent directory and that they do not have
version numbers as part of their names. The parent directory can be located anywhere
directory, e.g your home directory or just /usr/local/src:

<blockquote>
<pre>/usr/local/src/grace
/usr/local/src/juce
/usr/local/src/chicken</pre>
</blockquote>

<p> For any other installation configuration use the build/premake.lua
script to generate a <a href="#premake">custom build script</a> for
your machine.</p>

<h4 id="grace-linux">Grace / Linux (Makefile)</h4>
<blockquote>
<pre>$ cd build/linux
$ make Grace
</blockquote>

<h4 id="grace-macosx">Grace / OS X (XCode)</h4>
<ul>
<li>Double-click the XCode project file located in build/macosx.</li>
<li>Select <span class="menuitem">Grace</span> from the <span class="menuitem">Active Target</span> pop-up menu.</li>
<li>Select <span class="menuitem">Release</span> from the <span class="menuitem">Active Build Configuration</span> pop-up menu.</li>
<li>Click on <span class="menuitem">Build</span>.</li>
</ul>

<h4 id="grace-windows">Grace / Windows (CodeBlocks+mingw)</h4>
<ul>
<li>Double-click the Grace.cbp project file located in build/windows.</li>
<li>Select <span class="menuitem">Release</span> from the <span class="menuitem">Build Target</span> pop-up menu.</li>
<li>Select <span class="menuitem">Build</span> from the main <span class="menuitem">Build</span> menu in the menubar.</li>
</ul>

<h4 id="gracecl-linux">GraceCL / Linux (Makefile)</h4>
<blockquote>
<pre>$ cd build/linux
$ make GraceCL
</blockquote>

<h4 id="gracecl-macosx">GraceCL / OS X (XCode)</h4>
<ul>
<li>Double-click the XCode project file located in build/macosx.</li>
<li>Select <span class="menuitem">GraceCL</span> from the <span class="menuitem">Active Target</span> pop-up menu.</li>
<li>Select <span class="menuitem">Release</span> from the <span class="menuitem">Active Build Configuration</span> pop-up menu.</li>
<li>Click on <span class="menuitem">Build</span>.</li>
</ul>

<h4 id="gracecl-windows">GraceCL / Windows (CodeBlocks+mingw)</h4>
<ul>
<li>Double-click the GraceCL.cbp project file located in build/windows.</li>
<li>Select <span class="menuitem">Release</span> from the <span class="menuitem">Build Target</span> pop-up menu.</li>
<li>Select <span class="menuitem">Build</span> from the main <span class="menuitem">Build</span> menu in the menubar.</li>
</ul>

<h2 id="premake">Creating Custom Build Scripts with Premake</h2>

<p>If you have <a href="http:premake.sf.net">premake</a> installed you
can use the build/premake.lua script to generate a custom build script for
Linux, OS X or Windows/Mingw.


<h3>Premake Options</h3>

<dl>
<dt><code>--verbose</code></dt>
<dd>Enables printing compile and linking information during the build process. Highly recommended!</dd>
<dt><code>--jucedir <var>/path/to/juce/</var></code></dt>
<dd> Specifies a non-default path for juce directory (defaults are ../../../juce, /usr/local/src/juce)</dd>

<dt><code>--chickendir <var>/path/to/chicken/</var></code></dt>
<dd> specify a non-default path for chicken directory (Grace build only). (defaults to ../../../chicken, /usr/local/chicken).</dd>

<dt><code>--csound</code></dt>
<dd> Builds Grace with Csound port enabled. Csound libs and headers must be installed in their standard locations.</dd>

<dt><code>--release <var>nnn</var></code></dt>

<dd>Optional version release tag printed to Console window when the application starts
up. Value nnn is between 100 and 1000 and is printed n.n.n</dd>
  
<dt><code>--revision <var>num</var></code></dt>
<dd>Optional revision number printed to Console window when the application starts up.</dd>
</dl>

<p>Type <code>premake --help</code> for more information about the various build options.</p>


<h4>Generating Custom Makefiles</h4>

<ol>
<li> Change directory to  build/linux, build/macosx or build/windows.
<li>Copy the build/premake.lua file into that directory.</li>
<li> Call <code>premake</code>  and  pass it pas it the appropriate <code>--target</code> value along with any additional options.</li>
</ol>


<h5 id="premake-basic">Generating the normal Makefiles</h5>

<blockquote>
<pre class="code">$ cd grace/build/linux
$ cp ../premake.lua .
$ premake --verbose --target gnu
$ make
</pre>
</blockquote>

<h5 id="premake-juce">Generating Makefiles with alternate JUCE directory</h5>

<blockquote>
<pre class="code">$ cd grace/build/linux
$ cp ../premake.lua .
$ premake --verbose --target gnu --jucedir /home/hkt/juce-1.43
$ make
</pre>
</blockquote>

<h5 id="premake-csound">Generating Makefile with Csound Port enabled</h5>

<p>Building Grace with Csound also requires libcsound, libsndfile,
and libportaudio libraries.</p>

<blockquote>
<pre class="code">$ cd grace/build/linux
$ cp ../premake.lua .
$ premake --verbose --target gnu --csound
$ make Grace
</pre>
</blockquote>

<h2 id="installing">Installing Runtime Resources</h2>

<p>Once you have compiled Grace and/or GraceCL you should install the application's run-time documentation and support code:</p>

<blockquote>
  <pre class="code">$ cp ../install.sh .
$ ./install.sh Grace
$ ./install.sh GraceCL
</pre>
</blockquote>

<p>On OSX the installed resources are in:</p>

<ul>
  <li>build/Release/Grace.app/Contents/Resources/*</li>
  <li>build/Release/GraceCL.app/Contents/Resources/*</li>
</ul>

<p>
On Linux the installed resources are in:
</p>

<ul>
  <li>build/Release/Grace/lib/Grace/*</li>
  <li>build/Release/GraceCL/lib/GraceCL/*</li>
</ul>
   
<p>
On Windows the installed resources are in:
</p>

<ul>
  <li>build/Grace/Resources/*</li>
  <li>build/GraceCL/Resources/*</li>
</ul>

<p>Note that when you install GraceCL the installation script will attempt to download and install the latest versions of CLM, CM and FOMUS into the resource directory using svn and curl. The resource directory will become the default Lisp site directory when GraceCL starts up.
</p>

<p> The resource directory contains Grace's run-time Lisp code, help
files, tutorials, etc. The resource directory is bundled together with
the executable so you can move this application bundle anywhere,
e.g. into your /Applications folder on the Mac or your C:\Program
Files\ directory on Windows. On Linux you can move the contents of the
bin/ and lib/ directories to under /usr/local like this:</p>

<blockquote>
  <pre class="code"> $ sudo "(cd build/Release/Grace &amp;&amp; tar -cf - bin lib) | (cd /usr/local &amp;&amp; tar -xvf -)" </pre>
</blockquote>

<!-- h2 id="running">Running Grace </h2>

<p>Grace can run either Scheme or Common Lisp as its extension language.</p>
<ul>
<li>Grace with Scheme provides a cross-platform, real-time algorithmic composition environment. It is roughly equivalent to Emacs+Slime+CM+RTS+Portmidi. See <a href="scheme.html">Grace with Scheme</a> for more information.</li>
<li>Grace with Common Lisp is a cross-platform environment for working with Lisp systems like Common Music, CLM, CMN, Fomus, etc. It is roughly equivalent to Emacs+Slime+CM+CLM+Fomus</li>
</ul -->

<h2 id="grace">Running Grace</h2>

<p>Grace is linked against Chicken and (possibly) Csound when it is
built. If you do not statically link Grace with Chicken (by deleting
all libchicken.so or libuchicken.dylib libraries before you link) then
the libchicken.so library must reside somewhere on your path
(/usr/local/lib/libchicken.so for example) or Grace will fail to
start.  Similarily, if you download a binary version Grace with the Csound port
enabled then you must install the Csound5 library on your machine
before you start grace. </p>

<h2 id="gracecl">Running GraceCL</h2>

<p> To run GraceCL (Grace with Common Lisp) you must have a recent
version of <a
href="http://sbcl.sourceforge.net/platform-table.html">SBCL</a> or <a
href="http://sourceforge.net/project/showfiles.php?group_id=1355">Clisp</a>
installed on your machine. </p>

<p>Use <span class="menuitem">Console&gt;Lisp&gt;Configure
Lisp...</span> to configure your Lisp session profile.  </p>


<p> Select <span class="menuitem">Console&gt;Lisp&gt;Start Lisp</span>
to start a configured Lisp session.</p>

<p>Grace normally looks for Lisp software systems under its 'ASDF
systems directory'. The first time Grace starts up it sets the ASDF
systems directory to be the same as the Resource directory.  You can
change this path using the <span
class="menuitem">Console&gt;Lisp&gt;Configure Lisp...</span>
dialog.</p>

<p>To evaluate code, open use <span
class="menuitem">Console&gt;File&gt;New</span> to open an Editor
window. Then type code to evaluate in the buffer and press <span
class="emacscmd">COMMAND-Return</span> to send an expression to
Lisp. Evaluation output appears in the Console window.</p>

<p> See <span class="menuitem">Console&gt;Help</span> and <span
class="menuitem">Editor&gt;Help</span> for more information about this
process.</p>


<h3 id="starting">Starting from the Command Line</h3>

<p>Starting Grace or GraceCL from the command line allows you to pass
command line arguments to the app and makes debugging information
visible in the Terminal.</p>

<p>To start the application from the terminal on Linux type: </p>

<blockquote>
<pre class="code">$ grace &amp;</pre>
</blockquote>

<p> To start the application from the terminal on OS X type: </p>

<blockquote>
<pre class="code">$ exec /Applications/Grace.app/Contents/MacOS/Grace &amp;</pre>
</blockquote>

<h4 id="options">Command Line Options</h4>

<p>Grace supports the following command line options to override values stored in the preferences file.</p>
<dl>
  <dt><code>--no-prefs</code></dt>
  <dd> Tells Grace to not load your preferences file. Starts the application with its release configuration.</dd>
  <dt><code>--resource-directory</code> <var>directory</var></dt>
  <dd> Specifies a (non-default) location for the application resource directory.</dd>
  <dt><code>--asdf-systems-directory</code> <var>directory</var></dt>
  <dd> Specifies the location of the ASDF system directory.</dd>
  <dt><code>--clisp-program</code> <var>path</var></dt>
  <dd> The full pathname to your CLISP executable. </dd>
  <dt><code>--sbcl-program</code> <var>path</var></dt>
  <dd> The full pathname to your SBCL executable. </dd>
  <dt><code>--scheme-heap-size</code> <var>number</var></dt>
  <dd> The initial size of Scheme's heap. </dd>
  <dt><code>--scheme-stack-size</code> <var>number</var></dt>
  <dd> The initial size of Scheme's stack. </dd>
  </dl>

<h2 id="appendix">Appendix</h2>

<h3 id="juce">Installing JUCE</h3>

<p>Installing JUCE is straightforward, the biggest issue is making
sure you disable UNICODE support (everywhere), OpenGL support unless
you have the OpenGL libraries installed and (on Linux) disabling Xinerama support you don't use it.</p>


<h4 id="juce_linux">Installing JUCE on Linux</h4>

<ol>
  <li>
  <p>
  Edit the file juce/juce_Config.h.
  </p>

  <p> Turn Unicode support OFF by  setting JUCE_STRINGS_ARE_UNICODE to 0:</p>
  <pre class="code">
#ifndef JUCE_STRINGS_ARE_UNICODE
  #define JUCE_STRINGS_ARE_UNICODE 0 
#endif</pre>

  <p>[Strictly speaking you don't have to do this but if you don't the
  text editor will be too slow for anything but the smallest files.]
  </p>

  <p>
  Turn OFF OpenGL support unless you have the OpenGL libraries installed:
  </p>
  <pre class="code">#ifndef JUCE_OPENGL
  #define JUCE_OPENGL 0
#endif</pre>

  <p> Turn OFF Xinerama (multi-monitor lib) unless you are using
  it. (If so you will have to add it to the linking set): </p>

  <pre class="code">#ifndef JUCE_USE_XINERAMA
  #define JUCE_USE_XINERAMA 0
#endif</pre>
  </li>

  <li>
  <p>
  Make the Release version of libjuce.a:
  </p>

  <pre class="code">
$ cd juce/build/linux
$ make CONFIG=Release</pre>

 </li>
</ol>
 
<p>If you are successful the JUCE library will be saved in juce/bin/libjuce.a.
</p>


<h4 id="juce_osx">Installing JUCE on OSX</h4>

<ol>
  <li>

<p> Edit the file juce/juce_Config.h and turn Unicode support OFF by
setting JUCE_STRINGS_ARE_UNICODE to 0: </p>

<pre class="code">  
#ifndef JUCE_STRINGS_ARE_UNICODE
  #define JUCE_STRINGS_ARE_UNICODE 0 
#endif
</pre>
<p>

[Strictly speaking you don't have to do this but if you don't the text
 editor will be too slow for anything but the smallest files.]
</p>

<p>
  Turn OFF OpenGL support unless you have the OpenGL libraries installed:
</p>
  <pre class="code">
  #ifndef JUCE_OPENGL
  #define JUCE_OPENGL 0
#endif</pre>
  </li>

<li>
  <p> Edit the file juce/build/macosx/juce.xcconfig and make sure
  XCODE is using an appropriate SDK for your machine. Your SDKs are
  located under /Developer/SDKs/. This is the contents of my
  juce.xcconfig that I complied on a 10.4 PPC machine: </p>

<pre class="code">
ARCHS = ppc i386
SDKROOT = /Developer/SDKs/MacOSX10.4u.sdk
GCC_VERSION_ppc = 3.3
MACOSX_DEPLOYMENT_TARGET_ppc = 10.4
OTHER_LD_FLAGS_ppc = /Developer/SDKs/MacOSX10.4u.sdk/usr/lib/gcc/darwin/3.3/libstdc++.a
SDKROOT_ppc = /Developer/SDKs/MacOSX10.4u.sdk</pre>

</li>  

<li>
<p> Open the JUCE Xcode project in juce/build/macosx/Juce.xcodeproj
and select <span class="menuitem">Project&gt;Set Active Build Configuration&gt;Release</span>.  Then
press the Build icon.  If you are successful the JUCE library will be
saved in juce/bin/libjuce.a.  </p>
</li>
</ol>

<h3 id="chicken">Installing Chicken Scheme</h3>

<p>Restore the latest release of <a href =
"http://chicken.wiki.br/releases">Chicken Scheme</a> on your
machine. Change directories to the chicken distribution directory and
type just 'make' inside it to get the list of supported
platforms. Then compile and install chicken by passing the appropriate
value of PLATFORM to make:</p>

<blockquote>
<pre class="code">$ make PLATFORM=linux
$ sudo make PLATFORM=linux install</pre>
</blockquote>

<p>To build chicken Universal on OS X do this:</p>
<blockquote>
<pre class="code">$ export MACOSX_DEPLOYMENT_TARGET=10.4
$ make PLATFORM=macosx ARCH=universal
$ sudo make PLATFORM=macosx install</pre>
</blockquote>





<!--

<h3 id="building_binary">Building a Binary Installation of Grace</h3>
<p>How to make a relocatable, binary install of Grace. (Documented here mainly so I don't forget how to do it!)</p>
<ol>
  <li>First build and install Grace from sources as usual:
  <pre>$ scons JUCEDIR=/path/to/juce
$ scons install
</pre>
  </li>
  <li>Change directories to the Grace resource directory (Windows=build/Grace/Resources, OSX=build/Grace.app/Contents/Resources, Linux=/usr/local/lib/grace) and install the lisp sources for cm, Fomus and whatever other Lisp systems you want to include with the app:<pre>$ cd build/Grace.app/Contents/Resources
$ svn co http://commonmusic.svn.sf.net/svnroot/commonmusic/trunk/cm cm  
$ svn co svn://common-lisp.net/project/fomus/svn/fomus/trunk fomus
</pre>  
</li>
<li>Optional: Install CLISP or SBCL under the Resource dir (see below).</li>
</ol>
-->

</div>
<hr/>
<p>
<!-- hhmts start --> Last modified: Sun Mar  2 09:46:42 CST 2008 <!-- hhmts end -->
</p>
</body>
</html>
