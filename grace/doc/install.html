<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html
xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> <head>
<meta http-equiv="content-type" content="text/html;
charset=iso-8859-1"/> <style type="text/css" media="all"> @import
"grace.css"; </style> <title>The Console Window</title> </head> <body>
<div id="content">

<h1>Installing Grace</h1>

<h2 id="contents">Contents</h2>

<ul>
  <!-- li><a href="#binary_installation">Binary Installation</a></li -->
  <li><a href="#source_installation">Source Installation</a>
  <ul>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#svn">Downloading the sources (svn) </a></li>
    <li><a href="#compiling">Compiling the sources</a></li>
    <li><a href="#installing">Installing the runtime</a></li>
    <li><a href="#starting">Starting Grace with standard output visible</a></li>
    <li><a href="#lisp">Running Common Lisp under Grace</a></li>
  </ul>
</li>
    
  <li><a href="#building_binary">Building Binary Installation</a></li>

  <li><a href="#juce">Installing JUCE (version 4.3)</a>
  <ul>
    <li><a href="#juce_linux">Building JUCE on Linux</a></li>
    <li><a href="#juce_osx">Building JUCE on OS X</a></li>
  </ul>
  <li><a href="#chicken">Installing Chicken Scheme</a>

</li>
</ul>

<!-- h2 id="binary_installation">Binary Installation</h2>
<p><em>  Not written. </em></p -->


<h2 id="source_installation">Source Installation</h2>

<h3 id="requirements">Requirements</h3>

<p>Building Grace from sources requires that the following software systems are  installed and working properly on your system:

<ul>
  <li><a href="http://subversion.tigris.org/">Subversion</a></li>
  <li><a href="http://www.scons.org/">SCons</a></li>
  <li><a href="http://www.rawmaterialsoftware.com/juce/">JUCE</a> </li>
</ul>

<p>A working Lisp system is also required for the Grace runtime:</p>

<ul>
  <li>If you are building Grace with <a href="http://www.call-with-current-continuation.org">Chicken Scheme</a> then you need <a href="#chicken">libchicken</a>.

  <li>If you are building Grace to use with Common Lisp then you need to install the latest version of <a href="http://sbcl.sourceforge.net/platform-table.html">SBCL</a> or <a href="http://sourceforge.net/project/showfiles.php?group_id=1355">CLisp</a></li>

</ul>

<h3 id="svn">Downloading the sources (svn)</h3>
<p>
To download the Grace source tree type the following command all on one line:
</p>

<pre class="code">
$ svn co https://commonmusic.svn.sf.net/svnroot/commonmusic/trunk/grace</pre>

<h3 id="compiling">Compiling the sources</h3>

<p>To compile Grace with Chicken Scheme do:</p>

<pre class="code">
$ cd /path/to/grace
$ scons JUCEDIR=/path/to/jucedir SCHEME=1
</pre>

<p>To compile Grace to use with Common Lisp do:</p>

<pre class="code">
$ cd /path/to/grace
$ scons JUCEDIR=/path/to/jucedir
</pre>

<p>If you are successful the compiled files and exectuable will be in grace/build.</p>

<h3 id="installing">Installing the runtime</h3>

<p>Once you have compiled the app you can install the binary runtime (executable, documentation and runtime support) on your system:</p>

<pre class="code">
$ scons install</pre>
</pre>

<p>On OSX the installation paths are:</p>

   <blockquote>
       executable:	build/Grace.app/Contents/MacOS/grace<br/>
       resource dir:	build/Grace.app/Contents/Resources/*
   </blockquote>
   <p>
   On Linux the installation paths are:
   </p>

   <blockquote>
   executable:	/usr/local/bin/grace<br/>
   resource dir:	/usr/local/lib/grace/*
   </blockquote>
   
  <p>
   On Windows the installation paths are:
   </p>
   <blockquote>
       executable:	/build/Grace/grace.exe<br/>
       resource dir:	/build/Grace/Resources/*
   </blockquote>

   <p> The resource directory contains Grace's rutime Lisp code, help
   files, tutorials, etc.  On OS X and Windows the resource directory
   is bundled together with the executable so once you have done
   'scons install' you can move the application bundle anywhere,
   e.g. into your /Applications folder on the Mac or your C:\Program
   Files\ directory on Windows.  </p>

<p>If you have write permission in the installation directory its also
easiest if you install CM under that directory as well:</p>

<pre class="code">
$ cd /path/to/grace/resources/
$ svn co https://commonmusic.svn.sf.net/svnroot/commonmusic/trunk/cm cm</pre>

<p>Regardless of where you put your CM source tree, you should compile
CM sources from inside Grace or things won't work correctly when you
start lisp.</p>

<h3 id="starting">Starting Grace with standard output visible</h3>

 <p> Grace prints debugging information to standard output. To make
  this information visible you can start start the application from
  the terminal like this: </p>

   <pre class="code">
    # Linux:
    $ grace &
    # OS X:
    $ cd /path/to/grace
    $ exec build/Grace.app/Contents/MacOS/Grace &</pre>
   
<h3 id="scheme">Running Scheme under Grace</h3>

<p>In order to run Grace with Scheme the Chicken runtime library
(/usr/local/lib/libchicken) must be found by Grace when it starts
up. (On linux I had to copy the lib to /usr/lib/ for this to work).
If Grace starts without an error then Scheme is running and you don't
need to do anything else. </p>

<h3 id="cltl">Running Common Lisp under Grace</h3>

<p> In order to start Common Lisp under Grace you must have a recent
version of SBCL or Clisp installed on your machine and the Grace ASDF
Lisp system installed in either your Lisp systems directory or under
the Grace resource directory.  </p>

<p> Use the <span class="menuitem">Console&gt;Lisp&gt;Start
Lisp</span> menu item to start a Lisp session. Use <span
class="menuitem">Console&gt;Lisp&gt;Configure Lisp...</span> to
configure a Lisp session so that it can be started.  </p>

To establish a Lisp session Grace looks for its grace.asd Lisp system
under a 'Lisp systems directory' -- a root directory that contains the
various ASDF Lisp systems that you commonly work with. When Grace
starts up the Lisp systems directory defaults to the Resource
directory.  You can change this path using the <span
class="menuitem">Console&gt;Lisp&gt;Configure Lisp...</span>
dialog. The Lisp systems directory can be located anywhere on the file
system but the various ASDF system directories installed under it must
be writeable by the user. The Lisp systems directory should contain
(at a minimum) the Grace lisp system (shipped under the resource
directory) and the Common Music system.  If grace/grace.asd is not
found under the Lisp systems directory then Grace will use the version
shipped under the Resources directory. In this case, you must have
write permission in that directory since ASDF systems get compiled by
Lisp.  The first time you load an ASDF system it will be
compiled. Only load Common Music from systems that have been compiled
under Grace.  </p> <p> Output produced by evaluating Lisp code or SAL
commands appears in the Console window. The console window is NOT a
Lisp REPL. To evaluate Lisp or Sal code, open the appropriate type of
Editor window and used <span class="emacscmd">COMMAND-Enter</span> to
send expressions or SAL commands to Lisp. See <span
class="menuitem">Console&gt;Help</span> and <span
class="menuitem">Editor&gt;Help</span> for more information about this
process.  </p>

<h2 id="building_binary">Building a Binary Installation of Grace</h2>
<p>How to make a relocatable, binary install of Grace.</p>
<ol>
  <li>First build and install Grace from sources as usual:
  <pre>$ scons JUCEDIR=/path/to/juce
$ scons install
</pre>
  </li>
  <li>Change directories to the Grace resource directory (Windows=build/Grace/Resources, OSX=build/Grace.app/Contents/Resources, Linux=/usr/local/lib/grace) and install the lisp sources for cm, fomus and whatever other Lisp systems you want to include with the app:<pre>$ cd build/Grace.app/Contents/Resources
$ svn co http://commonmusic.svn.sf.net/svnroot/commonmusic/trunk/cm cm  
$ svn co svn://common-lisp.net/project/fomus/svn/fomus/trunk fomus
</pre>  
</li>
<li>Optional: Install CLISP or SBCL under the Resource dir (see below).</li>
</ol>

<h3>Installing a standalone CLISP under the resource directory</h3>
<h4>OSX PPC/Intel</h4>
<ol>
  <li>Download and untar the CLISP source tarball somewhere.</li>
  <li>Compile CLISP and make its distribution tarball:
<pre>$ ./configure --ignore-absence-of-libsigsegv --without-readline
$ cd src
$ ./makemake  --without-readline    > Makefile
$ make config.lisp
$ emacs config.lisp
$ make
$ make check
$ make distrib
</pre>
</li>
<li>Untar the distribution under the Grace resource directory and rename the clisp-nn/ directory to just clisp/:  
<pre>$ cd /path/to/grace/resources
$ tar -zxf /path/to/clisp/src/clisp.tar.gz
$ mv clisp-nn clisp
</pre></li>
</ol>



<h2 id="juce">Installing JUCE</h2>

<h3 id="juce_linux">Building JUCE on Linux</h3>

<ol>
  <li>
  <p>
  Edit the file juce/juce_Config.h and turn unicode support OFF by
  setting JUCE_STRINGS_ARE_UNICODE to 0:
  </p>

  <pre class="code">
#ifndef JUCE_STRINGS_ARE_UNICODE
  #define JUCE_STRINGS_ARE_UNICODE 0 
#endif</pre>

  <p>[Strictly speaking you don't have to do this but if you don't the
  text editor will be too slow for anything but the smallest files.]
  </p>

  </li>

  <li>
  <p>
  Turn OFF linking to the Xinerama  multi-monitor lib unless you
  are using it. If so you will have to add it to the linking set.
  </p>
  <pre class="code">
#ifndef JUCE_USE_XINERAMA
  #define JUCE_USE_XINERAMA 0
#endif</pre>
  </li>

  <li>
  <p>
  Make the Release version of libjuce.a:
  </p>

  <pre class="code">
$ cd juce/build/linux
$ make CONFIG=Release</pre>
</p>
  
<p>
  If you are successful the JUCE library will be saved in
  juce/bin/libjuce.a.
</p>
</li>
</ol>


<h3 id="juce_osx">Building JUCE on OSX</h3>

<ol>
  <li>

<p> Edit the file juce/juce_Config.h and turn unicode support OFF by
setting JUCE_STRINGS_ARE_UNICODE to 0: </p>

<pre class="code">  
#ifndef JUCE_STRINGS_ARE_UNICODE
  #define JUCE_STRINGS_ARE_UNICODE 0 
#endif
</pre>
<p>

[Strictly speaking you don't have to do this but if you don't the text
 editor will be too slow for anything but the smallest files.]

<li>

  <p> Edit the file juce/build/macosx/juce.xcconfig and make sure
  XCODE is using an appropriate SDK for your machine. Your SDKs are
  located under /Developer/SDKs/. This is the contents of my
  juce.xcconfig that I complied on a 10.4 PPC machine: </p>

<pre class="code">
ARCHS = ppc i386
SDKROOT = /Developer/SDKs/MacOSX10.4u.sdk
GCC_VERSION_ppc = 3.3
MACOSX_DEPLOYMENT_TARGET_ppc = 10.4
OTHER_LD_FLAGS_ppc = /Developer/SDKs/MacOSX10.4u.sdk/usr/lib/gcc/darwin/3.3/libstdc++.a
SDKROOT_ppc = /Developer/SDKs/MacOSX10.4u.sdk</pre>
</p>
</li>  

<li>
<p> Open the JUCE Xcode project in juce/build/macosx/Juce.xcodeproj
and select <span class="menuitem">Project&gt;Set Active Build Configuration&gt;Release</span>.  Then
press the Build icon.  If you are successful the JUCE library will be
saved in juce/bin/libjuce.a.  </p>
</li>
</ol>

<h2 id="chicken">Installing Chicken Scheme</h2>
<p>To build libchicken first download the lastest release of  <a href = "http://chicken.wiki.br/releases">Chicken Scheme</a> and then compile and install it. (Type just  'make'
 inside the chicken directory to get the list of supported platforms.)</p>

<pre class="code">
$ tar -zxf chickentar.gz
$ cd chicken
$ make
$ make PLATFORM=macosx
$ sudo make PLATFORM=macosx install
</pre>

<p>That will compile chicken and install its commands (csi, csc) and
library (libchicken) on your system. (If you are on linux then you may
also have to copy libchicken.so to /usr/bin if Grace can't find it
when it starts up...)</p>

</div>
<hr/>
<!-- hhmts start --> Last modified: Wed Nov 21 07:33:37 CST 2007 <!-- hhmts end -->
</body>
</html>
