<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1"/>
<style type="text/css" media="all">
@import "grace.css";
</style>
<title>Common Music 3</title>
</head>

<body>
<div id="content">

<h1> Common Music 3</h1>

<ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#scheduler">The Scheduler</a></li>
  <li><a href="#processes">Musical Processes</a></li>
  <li><a href="#send">Sending Data to Ports</a></li>
  <li><a href="#toolbox">Composition Toolbox</a>
  <ul>
    <li><a href="#environment">Environment</a></li>
    <li><a href="#lists">Lists</a></li>
    <li><a href="#iteration">Iteration</a></li>
    <li><a href="#mapping">Mapping and Transformation</a></li>
    <li><a href="#randomness">Randomness</a></li>
    <li><a href="#patterns">Patterns</a></li>
    <li><a href="#spectral">Spectral Manipulation</a></li>
    <li><a href="#midi-message">Midi Messages</a></li>
    </ul>
  <li><a href="#sal">SAL Syntax</a>
  </li>

  <li><a href="#examples">Examples</a></li>
<!--   <li><a href="#xml">XML Description</a></li> -->
</ul>

<h2 id="introduction">Introduction</h2>

<p>The Common Music 3 branch is implemented in <a
href="http://www.call-with-current-continuation.org">Chicken
Scheme</a> and optimized for realtime scheduling within the Grace
application. The distinguishing features of Common Music 3 compared to
the previous (CM 2) line:</p>

<ul>
  <li>Does not compile or load sources at runtime.</li>
  <li>Does not use an object system or generic functions.</li>

  <li>Terser function calling syntax to facilitate interactive coding:
  <ul>
    <li>Opt/key parameters with DSSL style keywords (symbols ending with a colon e.g. <code><var class="optkey">a:</var></code> ) replace &optional and &keyword parameters in both Scheme and SAL. For example the opt/key function

<code><span class="term">foo</span>(<var class="optkey">a:</var> <var class="optval">1</var>, <var class="optkey">b:</var> <var class="optval">3</var>)</code> could be called in any of the following ways: <code>foo() foo(4) foo(2, 3)  foo(a: 3) foo(b: 99) foo(a: 2, b: 4)</code>


    

</li>
    <li>Not dependance on on quoted symbols and minimal dependance on keywords in data.
    <li>Shorter names in general.</li>
  </ul>
  <li>SAL and Scheme equivalence. Documentation follows SAL syntax since its a simple matter for any Lisper to understand but the reverse is not true.</li>
</li>
  <li>Note names support quarter-tone inflections: quarter-tone down is <code>&lt;</code>, quarter-tone up is <code>&gt;</code>. For example <code>cs&gt;4</code> is one quarter-tone above <code>cs4</code>.</li>

  <!-- li>XML description replaces Lisp class definitions.</li -->
  <li>Ports replace files. </li>
</ul>


<!-- h3>Documentation Syntax</h3>

<ul>
<li id="required">Required parameters appear in cursive font <code><var>foo</var></code></li>

<li id="optional">Optional parameters appear in square brackets together with their default value: <code>[<var>foo 1</var>]</code></li>

<li id="variable">Variable parameters appear with ellipses <code><var>foo...</var></code></li>

<li id="named">Named parameters  appear as DSSSL keywords (named with colons at the end) along with their default values: <cod><var>foo: 1 bar: #f</var></code>.

</ul  -->

<h2 id="scheduler">The Scheduler</h2>

<p>The scheduler is a JUCE thread that executes on a 1 millisecond
tick. There are just a few entry points:</p>

<dl id="sprout"><dt class="entry"><span style="font-weight:bold;">sprout</span>  <var>process</var>, <var class="optkey">ahead:</var> <var class="optval">0</var>, <var class="optkey">id:</var> <var class="optval">#f</var><br/> &rarr; <var>void</var></dt>

<dd>Adds <a href="#processes"><var>process</var></a> to the scheduler
starting at <var>ahead</var> time from now. If <var>id</var> is provided it tags the process in the scheduling queue;
tagged processes can then be selectively removed from the scheduler
using <a href="#stop"><code>stop</code></a>. The <var>process</var>
parameter can be a single process or list of processes. If it is a
list then <var>ahead</var> and <var>id</var> can also be lists and
their values are paired with each process in left-to-right order. See
<a href="#processes">Musical Processes</a> for more information.</dd>
</dl>

<dl id="stop"><dt class="entry"><span class="term">stop</span> (<var>id...</var>)<br/>

  &rarr; <var>void</var></dt>

<dd>Stops processes currently running in the scheduling queue. If no
ids are given all the processes are stopped, otherwise only processes
with the specified ids are removed. Multiple processes can share a
common id.</dd> </dl>

<dl id="hush"><dt class="entry"><code><span class="term">hush</span> ()<br/> &rarr; <var>void</var></code></dt>
<dd>Stops all processes currently running and flushes any pending events in the output queue.</dd>
</dl>

<dl id="pause"><dt class="entry"><code><span class="term">pause</span> ()<br/> &rarr; <var>void</var></code></dt>
<dd>Suspends the process scheduler.</dd>
</dl>

<dl id="cont"><dt class="entry"><code><span class="term">cont</span> ()<br/> &rarr; <var>void</var></code></dt>
<dd>Resumes (continues) the paused scheduler.</dd>
</dl>

<dl id="now"><dt class="entry"><code><span class="term">now</span>  ()<br/> &rarr; <var>float</var></code></dt>
<dd>Returns the current time of the scheduler. See also <a href="#elapsed"><code>elapsed</code></a><!-- and <a href="#time-format"><code>time-format</code -->.</dd>
</dl>

<!-- p>The <a href="#send"><code>send</code></a> function enqueues data
into the scheduler if the data's time stamp is in the future (greater
than 0).</p -->


<h2 id="processes">Musical Processes</h2>

<p>A musical process is a Scheme function of one argument that you <a
href="#sprout"><code>sprout</code></a> into the scheduler with an
(optional) delay time. At the appropriate (real) time the scheduler
calls the function and passes it the elapsed time since the process
was sprouted. The function executes and returns either (1) the amount
of time the scheduler should wait until it calls the function again or
(2) a negative number if the function should not be called
again. </p>

<h3 id="go">The <code>go</code> Macro</h3> <p>The <code>go</code>
macro is an easy way to create a process function, it has the same
syntax as Scheme's <a
href="http://www.schemers.org/Documents/Standards/R5RS/HTML/r5rs-Z-H-7.html#%_sec_4.2.4"><code>do</code></a>
but returns an iterative process instead of performing iteration
directly. It also wraps your code inside an error handler so Scheme
can't crash from errors under the callback:</p>

<dl><dt class="entry"><code><span class="term">go</span> ((<var>var</var> <var>init</var> [<var>step</var>]) <var>...</var>)
   (<var>stop?</var> <var>finally</var> <var>...</var>)
  <var>body</var> <var>...</var></code></dt>
<dd>

After the name of the macro comes its <var>binding list</var>, each
binding is a list containing the name of a local variable
<var>var</var> followed by its initial value <var>init</var> and an
(optional) stepping expression <var>step</var>. After the binding list
comes the termination clause that is evaluated each time through the
loop; if the <var>stop?</var> expression is true then any
<var>finally</var> expressions are evaluated and the process stops
running.  If the <var>stop?</var> expression evaluates to false then
each <var>body</var> form is evaluated in sequential order.  These
forms have access to two local functions that are only defined within
the lexical body of <code>go</code>:</dd> </dl>

<dl id="wait"><dt class="entry"><code><span class="term">wait</span> (<var>ahead</var>)<br/>&rarr; <var>float</var></code></dt>

<dd><p>A local function only defined within the body of <a
href="#go"><code>go</code></a> that sets the time delta for the next
runtime of the process.</p></dd>

</dl>

<dl id="elapsed"><dt class="entry"><code><span class="term">elapsed</span> ()<br/>&rarr; <var>float</var></code></dt>

<dd><p>A local function only defined within the body of <a
href="#go"><code>go</code></a> that returns the elapsed time since the
process was first sprouted.</p></dd>

</dl>
  
<h4>Example</h4>

<blockquote>
<pre>(<span class="special">define</span> (<span class="defined">simp</span> n)
  (<span class="special">go</span> ((i 0 (+ i 1))
       (k 60 (ran 30 70)))
      ((= i n)  )
    (send <span class="string">"mp:midi"</span> <span class="keyword">key:</span> k)
    (wait .1)))

(sprout (simp 20))</pre>  
</blockquote>

<h2 id="send">Sending Data To Ports</h2>

<p>Every port implements a set of <var>methods</var> that you can send
data to.  This routing is accomplished using the <a href="#send"><code>send</code></a> macro and a <var>message</var>, a literal string or symbol containing the specfic port name and method </p>

<blockquote>
<code>"<var>port</var>:<var>method</var></code>"
</blockquote>

<p> and followed by whatever data arguments the specified method
takes. <p>Valid port names are (currently) <code>mp</code> for the Midi port and
<code>cs</code> for the Csound port.</p>

<dl>
  <dt class="entry"><code><span class="term">send</span> <var>message data ...</var><br/>&rarr; <var>void</var></code></dt>
<dd>

<p>

The first argument to <code>send</code> is its <var>message</var>, a
literal string or symbol in the format <var>port</var><span
style="font-weight: bold;">:</span><var>method</var> that identifies a
specific port and method to receive the <var>data</var> specified as
positional and/or keyword arguments to the macro. Parameters that do
not appear receive their default values (if any). Its an error to
specify positional values once keyword arguments have been introduced
or for a keyword name to appear more than once in the data list.  </p>
</dd> </dl>

<h4>Example</h4>

<div class="float">
<p><strong>SAL</strong></p>
<pre class="code">
<span class="command">send</span> <span class="string">"mp:midi"</span>, <span class="keyword">key:</span> 70
<span class="command">send</span> <span class="string">"mp:midi"</span>, 0, 1, 60, .1, 0
<span class="command">send</span> <span class="string">"mp:midi"</span>, 0, 1, <span class="keyword">key:</span> 60, <span class="keyword">chan:</span> 10
<span class="command">send</span> <span class="string">"mp:midi"</span>, <span class="keyword">chan:</span> 10, <span class="keyword">time:</span> 2, <span class="keyword">key:</span> 60
</pre>
</div>

<div class="float">
<p><strong>Scheme</strong></p>
<pre class="code">
(send <span class="string">"mp:midi"</span> <span class="keyword">key:</span> 70)
(send <span class="string">"mp:midi"</span> 0 1 60 .1 0)
(send <span class="string">"mp:midi"</span> 0 1 <span class="keyword">key:</span> 60 <span class="keyword">chan:</span> 10)
(send <span class="string">"mp:midi"</span> <span class="keyword">chan:</span> 10 <span class="keyword">time:</span> 2 <span class="keyword">key:</span> 60)
</pre>
</div>




<h3 id="midi-port">Midi Port Methods</h3>

<p>Before sending anything to the Midi Port first make sure you have
an output connection established with the <span
class="menuitem">Ports&gt;Midi Out&gt;</span> Menu in the Console
window. You can test that the connection actually works by using the
<span class="menuitem">Ports&gt;Midi Out&gt;Test</span> to send a
random burst of messages to the output device.</p>

<dl>
  <dt id="mp:midi" class="entry"><code><span class="term">send</span> <span class="string">"mp:midi"</span>,  <var class="optkey">time:</var> <var class="optval">0</var>, <var class="optkey">dur:</var> <var class="optval">.5</var>, <var class="optkey">key:</var> <var class="optval">60</var>, <var class="optkey">amp:</var> <var class="optval">.5</var>, <var class="optkey">chan:</var> <var class="optval"> 0</var></code>
  </dt>
  <dd><p>Send note data to midi port.</p></dd>

  <dt id="mp:on" class="entry"><code><span class="term">send</span> <span class="string">"mp:on"</span>, <var class="optkey">time:</var> <var class="optval">0</var>, <var class="optkey">key:</var> <var class="optval">60</var>, <var class="optkey">amp:</var> <var class="optval">.5</var>, <var class="optkey">chan:</var> <var class="optval">0</var></code></dt>

  <dd><p>Send note on data to midi port.</p>
</dd>

  <dt id="mp:off" class="entry"><code><span class="term">send</span> <span class="string">"mp:off"</span>, <var class="optkey">time:</var> <var class="optval">0</var> <var class="optkey">key:</var> <var class="optval">60</var>, <var class="optkey">vel:</var> <var class="optval">127</var>, <var class="optkey">chan:</var> <var class="optval">0</var></code></dt>
  <dd><p>Sends note off data to midi port.</p></dd>

  <dt id="mp:prog" class="entry"><code><span class="term">send</span> <span class="string">"mp:prog"</span>, <var class="optkey">time:</var> <var class="optval">0</var>,
    <var class="optkey">val:</var> <var class="optval">0</var>, <var class="optkey">chan:</var> <var class="optval">0</var></code></dt>
  <dd><p>Sends program change value to midi port. </p></dd>

  <dt id="mp:ctrl" class="entry"><code><span class="term">send</span> <span class="string">"mp:ctrl"</span>, <var class="optkey">time:</var> <var class="optval">0</var>,
    <var class="optkey">num:</var> <var class="optval">0</var>, <var class="optkey">val:</var> <var class="optval">0</var>, <var class="optkey">chan:</var> <var class="optval">0</var></code></dt>
  <dd><p>Sends control change data to midi port.</p></dd>

  <dt id="mp:touch" class="entry"><code><span class="term">send</span> <span class="string">"mp:touch"</span>, <var class="optkey">time:</var> <var class="optval">0</var>, <var class="optkey">val:</var> <var class="optval">0</var>, <var class="optkey">chan:</var> <var class="optval">0</var></code></dt>
  <dd>
    <p>Sends after touch value to midi port.</p>
  </dd>

  <dt id="mp:press" class="entry"><code><span class="term">send</span> <span class="string">"mp:press"</span>, <var class="optkey">time:</var> <var class="optval">0</var>, <var class="optkey">val:</var> <var class="optval">0</var>, <var class="optkey">chan:</var> <var class="optval">0</var></code></dt>
  <dd>
    <p>Sends channel pressure value to midi port.</p>
  </dd>

  <dt id="mp:bend" class="entry"><code><span class="term">send</span> <span class="string">"mp:bend"</span>, <var class="optkey">time:</var> <var class="optval"> 0</var>, <var class="optkey">val:</var> <var class="optval">8192</var>, <var class="optkey">chan:</var> <var class="optval">0</var></code></dt>
  <dd>
    <p>Sends pitch bend value 0-16383 to midi port.</p>
  </dd>

  <dt id="mp:mm" class="entry"><code><span class="term">send</span> <span class="string">"mp:mm"</span>, <var>message</var></code></dt>
  <dd>
    <p>Sends a low-level <a href="#midi-message">MIDI message</a> to the midi port.
  </dd>

  <dt id="mp:inhook" class="entry"><code><span class="term">send</span> <span class="string">"mp:inhook"</span> <var>function</var></code></dt>
  <dd><p>Sets <var>function</var> to receive Midi Messages that arrive at the Midi In port. The function is passed a single argument, the Midi Message received. See <a href="midimessage">Midi Messages</a> for more information. The hook should call <a href="#mm:free"><code>mm:free</code></a> on any message that it does not send to the output port.</p></dd>

</dl>


<h3 id="csound-port">Csound Port Methods</h3>
<dl>
<dt id="cs:i" class="entry">
  <code><span class="term">send</span> <span class="string">"cs:i"</span> <var>ins, start, duration ...</var></code>
  <br/>
<code><span class="term">send</span> <span class="string">"cs:i"</span> <var>list</var></code></dt>

  <dd>

   <p>Sends instrument data to the open Csound port.  The first value
    should be the instrument's number followed by the rest of its
    pfield values. For realtime audio the <var>start</var> value
    (pfield 2) should be 0. The <span class="string">"cs:i"</span>
    message also accepts a single <var>list</var> of values to be
    specified, in which case the <var>list</var> should contain the
    pfield data to send to Csound. The <span
    class="string">"cs:i"</span> message is also implemented as a
    Scheme function of the same name that can be called directly. For
    example, the following Scheme expressions are equivalent: </p>
    
<pre class="code">
(send <span class="string">"cs:i"</span> 1 0 1 60 1000)
(cs:i 1 0 1 60 1000)
(<span class="special">define</span> <span class="defined">mypars</span> '(1 0 1 60 1000))
(send <span class="string">"cs:i"</span> mypars)
(cs:i mypars) </pre>
    <p></p>
</dd>

<dt id="cs:f" class="entry">
  <code><span class="term">send</span> <span class="string">"cs:f"</span>, <var>num...</var></code>
  <br/>
<code><span class="term">send</span> <span class="string">"cs:f"</span>, <var>list</var></code></dt>
<dd><p>Sends function table data to Csound. Similar to <span class="string">"cs:i"</span> in all other respects.
  </dd>
<dt id="cs:clear" class="entry">
  <code><span class="term">send</span> <span class="string">"cs:clear"</span> </code>
<dd><p>Clears the current contents of the port's score buffer.
  </dd>

  </dl>


<p>The file "grace.orc" in the Grace resource directory can be used to
experiment with the Csound Port. The file contains two sample
instruments: <code>i1</code> is a karplus-strong pluck sound and
<code>i2</code> is a sinewave. Both instruments take five identical
parameters: <var>ins beg dur keynum amp</var> </code> where
<var>ins</var> is the instrument number (1 or 2), <var>beg</var> is
the begin time of the sound in seconds (normally 0 for realtime
audio), <var>dur</var> is the sound duration in seconds,
<var>keynum</var> is the note's frequency specified as a MIDI key
number, and <var>amp</var> is the note's amplitude (0-10000).  </p>


<p>See <a href="#example5">Example 5</a> for an example of sending data to the Csound port.</p>
  
<!--
<h3>Plotter Port Methods</h3>
<p>Routes data to the focus layer of the current plotter window. (Not yet implemented.)</p>
-->

<h2 id="toolbox">Composition Toolbox</h2>

<p>The following functions have been added to Chicken Scheme to
facilitate algorithmic music composition. Over time most of CM's
toolbox will become available as optional modules, e.g.  <code> (use
patterns)</code>, <code> (use tuning)</code>, etc.</p>

<h3 id="environment">Environment</h3>

  
<dl id="chdir">
<dt class="entry"><code><span class="term">chdir</span> <var>pathname</var><br/>&rarr; <var>void</var></code></dt>
<dd><p>Changes the current working directory to the <var>pathname</var> string. </p></dd>
</dl>

<dl id="cwd">
<dt class="entry"><code><span class="term">cwd</span> ()<br/>&rarr; <var>string</var></code></dt>
<dd><p>Returns the full pathname (string) of the current working directory. </p></dd>
</dl>



<h3 id="lists">Lists</h3>

<dl id="list*">
  <dt class="entry"><code><span class="term">list*</span> (<var>...</var> <var>list</var>)<br/>&rarr; <var>list</var></code></dt>
<dd><p>Adds the elements in <var>...</var> onto the front of <var>list</var></p></dd>
</dl>

<dl id="first">
<dt class="entry"><code><span class="term">first</span> <var>list</var> <!-- br/> <var>...</var --> <br/> <var>...</var> <br/> <span class="term">tenth</span> <var>list</var><br/>&rarr; <var>object</var></code></dt>
<dd><p>Returns the first, second, third, fourth, fifth, sixth, seventh, eighth, ninth or tenth element of a <var>list</var>.  </p></dd>
</dl>

<dl id="last">
<dt class="entry"><code><span class="term">last</span> <var>list</var><br/>&rarr; <var>object</var></code></dt>
<dd><p>Returns the last element in <var>list</var>. </p></dd>
</dl>

<dl id="butlast">
<dt class="entry"><code><span class="term">butlast</span> <var>list</var><br/>&rarr; <var>list</var></code></dt>
<dd><p>Returns all but the last element in <var>list</var>. </p></dd>
</dl>

<dl id="rest">
<dt class="entry"><code><span class="term">rest</span> <var>list</var><br/>&rarr; <var>list</var></code></dt>
<dd><p>Returns a list of all but the first element in <var>list</var>. </p></dd>
</dl>

<!-- dl id="tail">
<dt class="entry"><code><span class="term">tail</span> <var>list</var><br/>&rarr; <var>list</var></code></dt>
<dd><p>Returns the tail (final) list of <var>list</var>. </p></dd>
</dl -->



<h3 id="iteration">Iteration</h3>

<dl id="loop">
<dt class="entry"><code><span class="term">loop</span> {<var>clause</var>}*<br/>&rarr; <var>sexpr</var></code></dt>
<dd><p>An (essentially) complete implementation of the <a href="http://www.lisp.org/HyperSpec/Body/sec_6-1.html">Common Lisp loop macro</a> is provided. </p></dd>
</dl>

<h3 id="mapping">Mapping and Transformation</h3>

<dl id="note">
<dt class="entry"><code><span class="term">note</span> <var>freq</var><br/>&rarr; <var>symbol</var></code></dt>
<dd>

<p>

Returns the note name of <var>freq</var>, a key, note, or list of the
same. A note consists of a pitch class letter (<code>c d e f g a
b</code>), an optional sharp or flat letter (<code>s f</code>) an
optional quarter tone inflection (<code>&lt;</code> or
<code>&gt;</code>) and an octave number (<code>00</code>
to <code>9</code>). Note names can be specified as strings, symbols or
keywords. Inside note lists the octave number can be omitted from a
note name in which case the octave defaults to the last octave
specified, or to octave 4.

</p>

</dd></dl>

<dl id="key">
<dt class="entry"><span class="term">key</span> (<var>freq</var>)<br/>&rarr; <var>number</var></dt>
<dd><p>Returns the key (number) of <var>freq</var>, a note, hertz value or list of same.</p></dd></dl>

<dl id="hz">
<dt class="entry"><span class="term">hz</span> (<var>freq</var>)<br/>&rarr; <var>number</var></dt>
<dd><p>Returns the hertz value of <var>freq</var>, a note, key, or list of the same.</p></dd></dl>

<dl id="steps">
<dt class="entry"><span class="term">steps</span> (<var>num</var>, <var>start</var>, <var>step...</var>)<br/>&rarr; <var>list</var></dt>
<dd><p>Returns a list of <var>num</var> keys starting on <var>start</var> and incremented by each <var>step</var> (positive or negative) read mod the number of steps. For example, <code>(steps 24 60 2 1 )</code>  would return a 3 octave ascending octatonic scale starting on key number 60.</p></dd></dl>

<dl id="rescale">
<dt class="entry"><span class="term">rescale</span> (<var>x</var>, <var>x1</var>, <var>x2</var>, <var>y1</var>, <var>y2</var>, [<var>base 1</var>]) <br/>&rarr; <var>float</var></dt>
<dd><p>Returns a floating point value between <var>y1</var> and <var>y2</var> that is proportional to <var>x</var> between <var>x1</var> and <var>x2</var>. If <var>base</var> is 1 the rescaling is linear otherwise its exponential where <var>base</var> &gt; 1 produce increasing spread as <var>x</var> approaches <var>x2</var> and values  &lt; 1 produce decreasing spread.</p></dd></dl>
  
<dl id="discrete">
<dt class="entry"><span class="term">discrete</span> (<var>x</var>, <var>x1</var>, <var>x2</var>, <var>d1</var>, [<var>d2</var> #f], [<var>base 1</var>])<br/>&rarr; <var>sexpr</var></dt>
<dd><p>Similar to <code>rescale</code> except floating point <var>x</var> is mapped onto discrete values. If <var>d1</var> and <var>d2</var> are integers then <var>x</var> is mapped onto the range of integers  <var>d1</var> to <var>d2</var>. Otherwise, <var>d1</var> should be a list of values and <var>x</var> is mapped onto the elements of <var>d1</var> with <var>d2</var> an optional length that defaults to the length of <var>d1</var>. </p></dd></dl>

<dl id="interpl">
<dt class="entry"><span class="term">interpl</span> (<var>x</var>, <var>list</var>, [<var>base 1</var>])<br/>&rarr; <var>float</var></dt>
<dd><p>Same as CM.</p></dd></dl>

<dl id="interp">
<dt class="entry"><span class="term">interp</span> (<var>x</var>, <var>x1</var>, <var>y1</var> <var>...</var>)<br/>&rarr; <var>float</var></dt>
<dd><p>Same as CM.</p></dd></dl>


<dl id="rhythm-seconds">
<dt class="entry"><span class="term">rhythm-&gt;seconds</span> (<var>fraction</var>, <var class="optkey">tempo:</var> <var class="optval">60</var>, <var class="optkey">beat:</var>  <var class="optval">1</var>)<br/>&rarr; <var>float</var></dt>
<dd><p>Returns the time in seconds of <var>fraction</var> of <var>beat</var> in <var>tempo</var>.</p></dd></dl>

<dl id="cents-scaler">
<dt class="entry"><span class="term">cents-&gt;scaler</span> (<var>cents</var>)<br/>&rarr; <var>float</var></dt>
<dd><p>Same as CM.</p></dd></dl>

<dl id="scaler-cents">
<dt class="entry"><span class="term">scaler-&gt;cents</span> (<var>scaler</var>)<br/>&rarr; <var>int</var></dt>
<dd><p>Same as CM.</p></dd></dl>

<dl id="int">
<dt class="entry"><span class="term">int</span> (<var>num</var>)<br/>&rarr; <var>integer</var></dt>
<dd><p>Rounds floating point <var>num</var> to the nearest fixnum integer.</p></dd></dl>

<dl id="quantize">
<dt class="entry"><span class="term">quantize</span> (<var>num</var>, <var>step</var>)<br/>&rarr; <var>float</var></dt>
<dd><p>Quantizes <var>num</var> to size of <var>step</var>. <!-- Rounds a floating point <var>x</var> to the nearest multiple of <var>step</var> --></p></dd></dl>


<!-- dl id="decimals">
<dt class="entry"><span class="term">decimals</span> (<var>x</var> [<var>precision</var> 3])<br/>&rarr; <var>float</var></dt>
<dd><p>Same as CM. </p></dd></dl -->

<h3 id="randomness">Randomness</h3>

<p>All the functions that perform random selection are based on a common C++ random
state object that can be seeded using <a href="#ran-set!"><code>ran-set!</code></a>.</p>

<h4>Uniform Distribution</h4>

<dl id="ran">

<dt class="entry"><span class="term">ran</span> ([<var>n</var> 1.0] [<var>n2</var>])<br/>&rarr; <var>int</var> | <var>float</var></dt>

<dd><p>If called without arguments returns a random floating point number between 0
and 1 (exclusive). Otherwise <var>n</var> should be a positive or
negative number and a random number 0 to <var>n</var> (exclusive) and
of the same type as <var>n</var> (int or float) is returned. If
<var>n2</var> is provided then a random number between <var>n</var>
and <var>n2</var> (exclusive) is returned where <var>n2</var> can be
greater or less than <var>n</var>.</p></dd>

</dl>

<dl><dt class="entry"><span class="term">odds</span> (<var>n</var> [<var>true</var> #t] [<var>false</var> #f])<br/>&rarr; <var>sexpr</var></dt>
<dd><p>Same as CM.</p></dd></dl>

<dl id="pickl"><dt class="entry"><code><span class="term">pickl</span> (<var>list</var>)<br/>&rarr; <var>sexpr</var></code></dt>
<dd><p>Same as CM.</p></dd></dl>

<dl id="pick"><dt class="entry"><code><span class="term">pick</span> (<var>arg</var> <var>...</var>)<br/>&rarr; <var>sexpr</var></code></dt>
<dd><p>Same as CM.</p></dd></dl>

<dl id="between"><dt class="entry"><code><span class="term">between</span> (<var>low</var> <var>high</var>)<br/>&rarr; <var>number</var></code></dt>
<dd><p>Same as CM.</p></dd></dl>





<h4>Nonuniform Distributions</h4>

<dl id="ranpink"><dt class="entry"><code><span class="term">ranpink</span> ()<br/>&rarr; <var>float</var></code></dt>
<dd><p>Returns a pinkish  (1/f)  value between -1 and 1.</p></dd></dl>

<dl id="ranbrown"><dt class="entry"><code><span class="term">ranbrown</span> ()<br/>&rarr; <var>float</var></code></dt>
<dd><p>Returns a brownish  (1/f<sup>2</sup>) value between -1 and 1.</p></dd></dl>

<dl id="ranlow"><dt class="entry"><code><span class="term">ranlow</span> ()<br/>&rarr; <var>float</var></code></dt>
<dd><p>Returns a value between 0 and 1 with lower values more likely.</p></dd></dl>

<dl id="ranhigh"><dt class="entry"><code><span class="term">ranhigh</span> ()<br/>&rarr; <var>float</var></code></dt>
<dd><p>Returns a value between 0 and 1 with higher values more likely.</p></dd></dl>

<dl id="ranmid"><dt class="entry"><code><span class="term">ranmiddle</span> ()<br/>&rarr; <var>float</var></code></dt>
<dd><p>Returns a value between 0 and 1 with middle values more likely.</p></dd></dl>

<dl id="rangauss"><dt class="entry"><code><span class="term">rangauss</span> ([<var>lambda 1</var>], [<var>mu</var> 0])<br/>&rarr; <var>float</var></code></dt>
<dd><p>Returns unbounded value from the  <a href="http://en.wikipedia.org/wiki/Normal_distribution">normal distribution</a> with standard deviation <var>lambda</var> and mean <var>mu</var>.</p></dd></dl>

<dl id="ranexp"><dt class="entry"><code><span class="term">ranexp</span> ([<var>lambda 1</var>])<br/>&rarr; <var>float</var></code></dt>
<dd><p>Returns a value greater than 0 from the  <a href="">exponential distribution</a> with stretching factor <var>lambda</var>.</p></dd></dl>

<dl id="ranbeta"><dt class="entry"><code><span class="term">ranbeta</span> ([<var>a</var> .5], [<var>b</var> <var>a</var>])<br/>&rarr; <var>float</var></code></dt>
<dd><p>Returns value between 0 and 1 from the  <a href="http://en.wikipedia.org/wiki/Beta_distribution">beta distribution</a>.</p></dd></dl>

<dl id="rangamma"><dt class="entry"><code><span class="term">rangamma</span> ([<var>k</var> 1])<br/>&rarr; <var>float</var></code></dt>
<dd><p>Returns value greater than 0 from the  <a href="http://en.wikipedia.org/wiki/Gamma_distribution">gamma distribution</a>.</p></dd></dl>


<dl id="rancauchy"><dt class="entry"><code><span class="term">rancauchy</span> ()<br/>&rarr; <var>float</var></code></dt>
<dd><p>Returns an unbounded value from the <a href="http://en.wikipedia.org/wiki/Cauchy_distribution">Cauchy distribution</a>.</p></dd></dl>


<dl id="ranpoisson"><dt class="entry"><code><span class="term">ranpoisson</span> ([<var>lambda 1</var>])<br/>&rarr; <var>float</var></code></dt>
<dd><p>Returns an unbounded integer value from the <a href="http://en.wikipedia.org/wiki/Poisson_distribution">Poisson distribution</a> with shape factor <var>lambda</var>.</p></dd></dl>

<h4>Seeding</h4>

<dl id="ran-set"><dt class="entry"><code><span class="term">ran-set!</span> (<var>uint</var>)<br/>&rarr; <var>void</var></code></dt><dd><p>Initialize the random state generator with the unsigned integer value <var>uint</var>.</p></dd></dl>

<h3 id="patterns">Patterns</h3>

<p>

Patterns are objects that generate data in different
orderings. Patterns can used individually or <em>nested</em>
 to form local orderings (sub-patterns) within the surrounding
pattern.

</p>

<div class="float" id="table_1">
<table>
<tr><th class="lcol">Pattern</th><th class="lcol">Description</th></tr>
<tr><td><a href="#make-cycle">Cycle</a> </a> <td>generates its elements in a continuous loop</td></tr>
<tr><td><a href="#make-line">Line</a></td><td>generates its elements sequentially and sticks on last element</td></tr>
<tr><td><a href="#make-palindrome">Palindrome</a></td><td>generates its elements forwards and backwards</td></tr>
<tr><td><a href="#make-heap">Heap</a></td><td>generates random permutations of its elements</td></tr>
<tr><td><a href="#make-rotation">Rotation</a></td><td>generates systematic permutations of its elements</td></tr>
<tr><td><a href="#make-weighting">Weighting</a></td><td>generates elements from a weighted random distribution</td></tr>
<tr><td><a href="#make-markov">Markov</a></td><td>generates nth order Markov chains of its elements</td></tr>
<tr><td><a href="#make-graph">Graph</a></td><td>generates elements from a directed graph</td></tr>
</table>
</div>



<dl id="make-cycle"><dt class="entry"><span class="term">make-cycle</span> (<var>items</var>, <var class="optkey">for:</var> <var class="optval">#f</var>, <var class="optkey">repeat:</var> <var class="optval">#f</var>) <br/>&rarr; <var>pattern</var></dt>
<dd >

Returns a pattern that generates its elements in a continual loop.

<var>Items</var> is the list of data to generate and can include sub-patterns.

<var>For</var> sets the number of internal reads that will make up the next period, or chunk, of data returned from the pattern. This value can be a number or pattern of numbers and defaults to the length of <var>items</var>.
  
<var>Repeat</var> sets an optional limit on the number of periods that the pattern can generate; once this limit has
been reached the pattern will return an <a href="#eod?">end of data</a> marker instead of elements.
</dd>
</dl>

<dl id="make-line"><dt class="entry"><span class="term">make-line</span> (<var>items</var>, <var class="optkey">for:</var> <var class="optval">#f</var>, <var class="optkey">repeat:</var> <var class="optval">#f</var>) <br/>&rarr; <var>pattern</var></dt>
<dd>
  <p>Returns a pattern that generates <var>items</var> sequentially and sticks on the last item.</p>
</dd>
</dl>

<dl id="make-palindrome"><dt class="entry"><span class="term">make-palindrome</span> (<var>items</var>, <var class="optkey">for:</var> <var class="optval">#f</var>, <var class="optkey">repeat:</var> <var class="optval">#f</var>, <var class="optkey">elide:</var> <var class="optval">#f</var>) <br/>&rarr; <var>pattern</var></dt>
<dd>
  <p>Returns a pattern that generates <var>items</var> forwards and backwards. <var>Elide</var> determines what happens to the first and last items when the pattern reverses itself. If the value is false then these items are repeated. If the value is true then neither item is directly repeated. Otherwise the value can should be a two element list {<var>bool</var> <var>bool</var>} specifying the repeat value for the first and last item.</p>
</dd>
</dl>


<dl id="make-weightings"><dt class="entry"><code><span class="term">make-weightings</span> (<var>items</var>, <var class="optkey">for:</var> <var class="optval">#f</var>, <var class="optkey">repeat:</var> <var class="optval">#f</var>) <br/>&rarr; <var>pattern</var></dt>
<dd>
  <p>Returns a weighting pattern that generates <var>items</var> from a weighted distribution.</p>
Each item can be a datum, subpattern, or list:
  <blockquote>
  <pre>{<var>item</var> [<var>weight 1</var>] [<var>min 1</var>] [<var>max #f</var>]}</pre>
  </blockquote>
where <var>item</var> is the thing to generate, <var>weight</var> is its weight in the distribution relative to the other items in the pattern, <var>min</var> is the minimum number of times that <var>item</var> must be directly selelected before another item can be considered, and <var>max</var> is the maximum number of times that <var>item</var> can be directly selected before another item must be selected.
  </p>
</dd>
</dl>

<dl id="make-rotation"><dt class="entry"><span class="term">make-rotation</span> (<var>items</var>, <var class="optkey">for:</var> <var class="optval">#f</var>, <var class="optkey">repeat:</var> <var class="optval">#f</var> <var class="optkey">rotate:</var> <var class="optval">{0}</var>) <br/>&rarr; <var>pattern</var></dt>
<dd>
  <p>Returns a pattern that rotates its items according to <var>rotate</var>, which can be a list or a pattern of lists of the format:</p.
<blockquote>
  <pre>{<var>start</var> [<var>end</var>] [<var>step 1</var>] [<var>width 1</var>]}</pre>
</blockquote>
</dd>
</dl>

<dl id="make-markov"><dt class="entry"><span class="term">make-markov</span> (<var>items</var>, <var class="optkey">for:</var> <var class="optval">#f</var>, <var class="optkey">repeat:</var> <var class="optval">#f</var> <var class="optkey">past:</var> <var class="optval">{...}</var>) <br/>&rarr; <var>pattern</var></dt>
<dd>
  <p>Returns a pattern that generates its items according to (nth order) transitions lists:</p>
<blockquote>
  <pre>{<var>past ...</var> -&gt; {<var>next weight<var>} ... }</pre>
</blockquote>
<p> Items appearing before <code>-&gt;</code> in the rule are the past choice(s) that trigger the transition and items following <code>-&gt;</code> make up the weighted distribution determining the transition's next outcome. If <var>past</var> it supplied it will be the initial past choices to match the transitions against, otherwise the first transition rule is used. </p>
</dd>
</dl>

<dl id="make-graph"><dt class="entry"><span class="term">make-graph</span> (<var>items</var>, <var class="optkey">for:</var> <var class="optval">#f</var>, <var class="optkey">repeat:</var> <var class="optval">#f</var>) <br/>&rarr; <var>pattern</var></dt>
<dd>
  <p>Returns a pattern that generates its items from a directed graph of nodes with transition patterns. Each node is a list:</p>
<blockquote>
  <pre>{<var>item</var> <var>to<var> [<var>id</var>] }</pre>
</blockquote>
<p>where <var>item</var> is the item or pattern to generate, <var>to</var> is an id or pattern of ids identifiying which node should follow the current node in the graph, and <var>id</var> is a unique identifier for the node which defaults to successive integers starting from 1.
  
</dd>
</dl>


<h3 id="spectral">Spectral Manipulation</h3>
<p>blah </p>




<h3 id="midi-message">Midi Messages</h3>

<p> Data from the open MIDI input port is packaged in low-level (C++)
MidiMessages. The following functions provided an API for manipulating
these objects in Scheme.</p>

<dl id="mm:make-on"><dt class="entry"><code class="entry">mm:make-on</code> <var class="optkey">time:</var> <var class="optval">0</var> <var class="optkey">key:</var> <var class="optval"> 60 </var> <var class="optkey">vel:</var> <var class="optval"> 64 </var>  <var class="optkey">chan:</var> <var class="optval"> 0 </var>
<br/>&rarr; <var>message</var></code></dt>
<dd>

<p>
Allocates a new Midi Note On message.
</p>
</dd>
</dl>

<dl id="mm:on?"><dt class="entry"><code><span class="term">mm:on?</span> <var>message</var>
<br/>&rarr; <var>boolean</var></code></dt>
<dd>

<p>
Returns true if <var>message</var> is a Midi Note On message , otherwise false.
</p>
</dd>
</dl>


<dd><p>The time (in seconds) to wait before the event will sound. Defaults to 0.0</p></dd>


<dd><p>The channel number of the event. Defaults to 0.</p></dd>

<dd><p>An integer key number value 0-127. Defaults to 60.</p></dd>

<dt><code class="keyword">val:</code> <em>integer</em></dt>
<dd><p>An integer aftertouch value 0-127. Defaults to 0.</p></dd>


<dt><code class="keyword">num:</code> <em>integer</em></dt>
<dd><p>A integer controller number 0-127. Defaults to 0.</p></dd>
<dt><code class="keyword">val:</code> <em>integer</em></dt>
<dd><p>An integer control change value 0-127. Defaults to 0.</p></dd>


<p>
Keyword arguments applicable to <code class="entry">mm:prog</code> messages:
</p>
<dl>
<dt><code class="keyword">val:</code> <em>integer</em></dt>
<dd><p>An integer program change value 0-127. Defaults to 0.</p></dd>
</dl>

<p>
Keyword arguments applicable to <code class="entry">mm:press</code> messages:
</p>
<dl>
<dt><code class="keyword">val:</code> <em>integer</em></dt>
<dd><p>An integer pressure change value 0-127. Defaults to 0.</p></dd>
</dl>

<p>
Keyword arguments applicable to <code class="entry">mm:bend</code> messages:
</p>
<dl>
<dt><code class="keyword">val:</code> <em>integer</em></dt>
<dd><p>An integer pitch bend value 0-16383. Defaults to 0.</p></dd>
</dl>
</p></dd>
</dl>

<dl id="mm:free"><dt class="entry"><code><span class="term">mm:free</span> (<var> message</var>)<br/>&rarr; <var>void</var></code></dt>
<dd><p>
Deletes and reclaims memory from an allocated message. Note that the Midi Out port automatically frees messages once they are sent out the midi port. This function should be called by input hooks to free any message that it receives but does not use.
</p></dd>
</dl>

<dl id="mm:copy"><dt class="entry"><code><span class="term">mm:copy</span> (<var> message</var>)<br/>&rarr; <var>message</var></code></dt>
<dd><p>
Returns a copy of the specified midi message.
</p></dd>
</dl>

<dl id="mm:type?"><dt class="entry"><code><span class="term">mm:type?</span> (<var> message type</var>)<br/>&rarr; <var>bool</var></code></dt>
<dd><p>
Returns true if the MIDI <var>message</var> is of the specified <var>type</var>, one of <code class="entry">mm:off mm:on mm:touch mm:ctrl mm:prog mm:press mm:bend</code>.
</p></dd>
</dl>





<dl id="mm:time"><dt class="entry"><code><span class="term">mm:time</span> (<var> message</var>)<br/>&rarr; <var>float</var></code></dt>
<dd><p>
Returns the time value of a midi message.
</p></dd>
</dl>
<dl id="mm:time-set!"><dt class="entry"><code><span class="term">mm:time-set!</span> (<var> message value</var>)<br/>&rarr; <var>float</var></code></dt>
<dd><p>
Sets the time value of a midi message.
</p></dd>
</dl>

<dl id="mm:chan"><dt class="entry"><code class="term">mm:chan</code> <var> message</var><br/>&rarr; <var>integer</var></dt>
<dd><p>
Returns the channel value of a midi message.
</p></dd>
</dl>
<dl id="mm:chan-set!"><dt class="entry"><code><span class="term">mm:chan-set!</span> (<var> message value</var>)<br/>&rarr; <var>integer</var></code></dt>
<dd><p>
Sets the channel value of a midi message.
</p></dd>
</dl>

<dl id="mm:key"><dt class="entry"><code><span class="term">mm:key</span> (<var> message</var>)<br/>&rarr; <var>integer</var></code></dt>
<dd><p>
Returns the key number of an <code class="entry">mm:on</code> or <code class="entry">mm:off</code> message.
</p></dd>
</dl>
<dl id="mm:key-set!"><dt class="entry"><code><span class="term">mm:key-set!</span> (<var> message value</var>)<br/>&rarr; <var>integer</var></code></dt>
<dd><p>
Sets the key number of an <code class="entry">mm:on</code> or <code class="entry">mm:off</code> message.
</p></dd>
</dl>

<dl id="mm:vel"><dt class="entry"><code><span class="term">mm:vel</span> (<var> message</var>)<br/>&rarr; <var>integer</var></code></dt>
<dd><p>
Returns the velocity value of an <code class="entry">mm:on</code> message.
</p></dd>
</dl>
<dl id="mm:vel-set!"><dt class="entry"><code><span class="term">mm:vel-set!</span> (<var> message value</var>)<br/>&rarr; <var>integer</var></code></dt>
<dd><p>
Sets the velocity value of an <code class="entry">mm:on</code> message.
</p></dd>
</dl>

<dl id="mm:val"><dt class="entry"><code><span class="term">mm:val</span> (<var> message</var>)<br/>&rarr; <var>integer</var></code></dt>
<dd><p>
Returns the message value of an <code class="entry">mm:touch mm:ctrl mm:prog mm:press mm:bend</code> message.
</p></dd>
</dl>
<dl id="mm:val-set!"><dt class="entry"><code><span class="term">mm:val-set!</span> (<var> message value</var>)<br/>&rarr; <var>integer</var></code></dt>
<dd><p>
Sets the message value of an <code class="entry">mm:touch mm:ctrl mm:prog mm:press mm:bend</code> message.
</p></dd>
</dl>

<dl id="mm:num"><dt class="entry"><code><span class="term">mm:num</span> (<var> message</var>)<br/>&rarr; <var>integer</var></code></dt>
<dd><p>
Returns the controller number of an <code class="entry">mm:ctrl</code> message.
</p></dd>
</dl>
<dl id="mm:num-set!"><dt class="entry"><code><span class="term">mm:num-set!</span> (<var> message value</var>)<br/>&rarr; <var>integer</var></code></dt>
<dd><p>
Sets the controller number value of an <code class="entry">mm:ctrl</code> message.
</p></dd>
</dl>

<h2 id="sal">SAL Syntax</h2>
<p><a href="http://commonmusic.sf.net/doc/dict/sal-topic.html">SAL syntax</a> is fully supported in Chicken Scheme with the following enhancements over the Common Lisp implementation: </p>

<ul>

<li>The <code><span class="command">send</span></code> command sends data to ports:

<blockquote>
<pre><span class="command">send</span> <span class="string">"mp:midi"</span>, 0, 1, 60, .1
<span class="command">send</span> <span class="string">"mp:midi"</span>, <span class="keyword">key:</span> 60, <span class="keyword">dur:</span> .1
</pre>
</blockquote>
</li>

<li>Quasi-quotation is supported in constant lists. Use <code><span class="constant">#$</span></code> to unquote and <code><span class="constant">#^</span></code> to unquote-splice:

<blockquote>
<pre><span class="command">begin</span>
  <span class="reserved">with</span> foo = 99
  <span class="reserved">print</span> {x <span class="constant">#$</span> foo y <span class="constant">#^</span> list(foo, foo + 1, foo + 2) z}
<span class="command">end</span>
&rarr; {x 99 y 99 100 101 z}
</pre>
</blockquote>
</li>

<li>Variable length (&rest) parameters to functions or processes can
be defined by appending <code>...</code> to the last argument's
name.</li>

<blockquote>
<pre><span class="command">define</span> <span class="class">function</span> foo (a, b...)
  <span class="reserved">return</span> a * apply(+, b)
</pre>
</blockquote>


<li>Functions can be applied to arguments:
<blockquote>
<pre>
<span class="command">print</span> apply(+, {1 2 3 4 5})
</pre>
</blockquote>
</li>

<li>The commands <code><span class="command">open</span></code> and <code><span class="command">output</span></code> are not supported in Scheme.
</li>

</ul>

<p>See <a href="http://commonmusic.sf.net/doc/dict/sal-topic.html">SAL documentation</a> for more information.


<h2 id="examples">Code Examples</h2>

<h3 id="example1">Example 1</h3>


<p>Mapping pink noise onto scales.</p>

<div class="float">
<p><strong>Scheme</strong></p>
<pre class="code">
(<span class="special">define</span> (<span class="defined">pinkscale</span> len scale)
  (<span class="special">go</span> ((i 0 (+ i 1)))
      ((= i len) )
    (send <span class="string">"mp:midi"</span> <span class="keyword">key:</span> (discrete (ranpink) -1 1 scale))
    (wait .2)))

(<span class="special">define</span> <span class="defined">dorian</span> (steps 50 20 2 1 2 2 2 1 2))

(sprout (pinkscale 100 dorian))

(<span class="special">let</span> ((wierd (steps 40 20 2 (ran 1 4) 2 (ran 1 4) 2)))
  (sprout (pinkscale 100 wierd)))
</pre>
</div>

<div class="float">
<p><strong>SAL</strong></p>
<pre class="code">
<span class="command">define</span> <span class="class">process</span> pinkscale(len, scale)
  <span class="reserved">run</span> <span class="reserved">repeat</span> len
    <span class="reserved">send</span> <span class="string">"mp:midi"</span>, <span class="keyword">key:</span> discrete( ranpink(), -1, 1, scale)
    <span class="reserved">wait</span> .2
  <span class="reserved">end</span>

<span class="command">define</span> <span class="class">variable</span> dorian = steps(50, 20, 2, 1, 2, 2, 2, 1, 2)

<span class="command">sprout</span> pinkscale(100, dorian)

<span class="command">begin</span> <span class="reserved">with</span> weird = steps(40, 20, ran(1,4), 2, ran(1,4), 2)
  <span class="reserved">print</span> <span class="string">"scale="</span>, weird
  <span class="reserved">sprout</span> pinkscale(100, weird)
<span class="command">end</span>
</pre>
</div>


<h3 id="example2">Example 2</h3>

<p>Using ids to selectively stop processes.</p>
<div class="float">
<p><strong>Scheme</strong></p>
<pre class="code">
(<span class="special">define</span> (<span class="defined">chopin</span> n r d k)
  (<span class="special">go</span> ((i 0 (+ i 1)))
      ((= i n) <span class="constant">#f</span>)
    (send <span class="string">"mp:midi"</span> <span class="keyword">dur:</span> d <span class="keyword">key:</span> k)
    (wait r)))

<span class="comment">;; sprout D# minor chord with ids</span>

(<span class="special">begin</span> 
  (sprout (chopin 100 .5 .25 63) 0 1)
  (sprout (chopin 100 .5 .25 66) 0 2)
  (sprout (chopin 100 .5 .25 70) 0 3)
  (sprout (chopin 100 .5 .25 75) 0 1)
  )

<span class="comment">;; first stop F#, then A# then the D# octave</span>

(stop 2)
(stop 3)
(stop 1)
</pre>
</div>

<div class="float">
<p><strong>SAL</strong></p>
<pre class="code">
<span class="command">define</span> <span class="class">process</span> chopin (n, r, d, k)
  <span class="reserved">run</span> <span class="reserved">repeat</span> n
    <span class="reserved">send</span> <span class="string">"mp:midi"</span>, <span class="keyword">dur:</span> d, <span class="keyword">key:</span> k
    <span class="reserved">wait</span> r
  <span class="reserved">end</span>

<span class="comment">;; sprout D# minor chord with ids</span>

<span class="command">begin</span>
  <span class="reserved">sprout</span> chopin(50, .5, .25, 63), 0, 1
  <span class="reserved">sprout</span> chopin(50, .5, .25, 66), 0, 2
  <span class="reserved">sprout</span> chopin(50, .5, .25, 70), 0, 3
  <span class="reserved">sprout</span> chopin(50, .5, .25, 75), 0, 1
<span class="command">end</span>

<span class="comment">;; first stop F#, then A# then the D# octave</span>

<span class="command">exec</span> stop(2)
<span class="command">exec</span> stop(3)
<span class="command">exec</span> stop(1)
</pre>
</div>


<h3 id="example3">Example 3</h3>

<p>Pentatonic wind chimes with amp envelope and exponential decay.</p>

<div class="float">
<p><strong>Scheme</strong></p>
<pre class="code">
(<span class="special">define</span> (<span class="defined">chimes</span> n)
  (<span class="special">go</span> ((i 0 (+ i 1))
       (l '(0 2 5 7 9 12))
       (k (+ 37 (* 12 (ran 6)))))
      ((= i n) <span class="constant">#f</span>)
    (send <span class="string">"mp:midi"</span> 0 (ran 2.0 4.0)
          (+ k (list-ref l (ran 6)))
          (interp i 0 90 n 30))
    (wait (rescale i 0 n .1 (ran 1.5 2.0) 50))))

(sprout (chimes 20 ) )
</pre>
</div>

<div class="float">
<p><strong>SAL</strong></p>
<pre class="code">
<span class="command">define</span> <span class="class">process</span> chimes(n)
  <span class="reserved">run</span> <span class="reserved">with</span> l = {0 2 5 7 9 12}, k = 37 + (12 * ran(6))
    <span class="reserved">for</span> i <span class="reserved">below</span> n
    <span class="reserved">send</span> <span class="string">"mp:midi"</span>, 0, ran( 2.0, 4.0),
         k + list-ref( l, ran( 6)),
         interp(i, 0, 90, n, 30)
    <span class="reserved">wait</span> rescale( i, 0, n, .1, ran(1.5, 2.0), 50)
  <span class="reserved">end</span>

<span class="command">sprout</span> chimes( 20 )
</pre>
</div>

 
<h3 id="example4">Example 4</h3>

<p>Triggering realtime processes via a MIDI input hook.</p>

<div class="float">
<p><strong>Scheme</strong></p>
<pre class="code">
<span class="comment">;; define a process thats plays a major or minor scale based on a given key</span>

(<span class="special">define</span> (<span class="defined">playscale</span> key dur)
  (<span class="special">let</span> ((scale (<span class="special">if</span> (odds .5)
                 (steps 15 key 2 2 1 2 2 2 1)
                 (steps 15 key 2 1 2 2 2 1 2))))
    (<span class="special">go</span> ((i 0 (+ i 1))
         (l (length scale))
         (r (/ dur (length scale))))
        ((= i l) <span class="constant">#f</span>)
      (send <span class="string">"mp:midi"</span> <span class="keyword">key:</span> (list-ref scale i) 
            <span class="keyword">dur:</span> .5
            <span class="keyword">amp:</span> (interp i 0 .9 l .5))
      (wait r))))

<span class="comment">;; test the process</span>
  
(sprout (playscale 60 1.2))

<span class="comment">;; define a hook to play a scale based on a key you press...</span>

(<span class="special">define</span> (<span class="defined">myhook</span> m)
  (<span class="special">if</span> (mm:type? m mm:on)
    (<span class="special">let</span> ((k (mm:key m)))
      (sprout (playscale k 1.2)))))

<span class="comment">;; set hook ...</span>

(send <span class="string">"mp:inhook"</span> myhook)

<span class="comment">;; now play your MIDI keyboard ...  then clear your hook when done</span>

(send <span class="string">"mp:inhook"</span> <span class="constant">#f</span>)
</pre>
</div>

<div class="float">
<p><strong>SAL</strong></p>
<pre class="code">
<span class="command">define</span> <span class="class">process</span> playscale(key, dur)
  <span class="reserved">run</span> <span class="reserved">with</span> scale = odds(.5, steps(15, key, 2, 2, 1, 2, 2, 2, 1),
                        steps(15, key, 2, 1, 2, 2, 2, 1, 2)), 
           len = length(scale)
    <span class="reserved">for</span> i <span class="reserved">below</span> len
    <span class="reserved">send</span> <span class="string">"mp:midi"</span>, <span class="keyword">key:</span> list-ref( scale, i),
         <span class="keyword">dur:</span> .5,
         <span class="keyword">amp:</span> interp( i, 0, .9, len, .5)
    <span class="reserved">wait</span> dur / len
  <span class="reserved">end</span>

<span class="comment">;; test the process</span>
  
<span class="command">sprout</span> playscale( 60, 1.2)

<span class="comment">;; define a hook to play a scale based on a key you press...</span>

<span class="command">define</span> <span class="class">function</span> myhook (m)
  <span class="reserved">if</span> mm:type?( m, mm:on) <span class="reserved">then</span>
    <span class="reserved">begin</span> <span class="reserved">with</span> k = mm:key(m)
      <span class="reserved">sprout</span> playscale(k, 1.2)
    <span class="reserved">end</span>

<span class="comment">;; set hook ...</span>

<span class="command">send</span> "mp:inhook"</span>, myhook

<span class="comment">;; now play your MIDI keyboard ...  then clear your hook when done</span>

<span class="command">send</span> "mp:inhook"</span>, #f</span>
</pre>
</div>

<h3 id="example5">Example 5</h3>

<p>Sending audio data to the Csound port in realtime. (The i1 instrument is defined in the file 'grace.orc' located in the application's resource directory.)
</p>

<div class="float">
<p><strong>Scheme</strong></p>
<pre class="code">
<span class="comment"> </span>
(<span class="special">define</span> (<span class="defined">rani1</span> len rhy lb ub amp)
  (<span class="special">go</span> ((num 0 (+ num 1))
       (dur (* rhy 2))
       (key lb (ran lb ub)))
      ((= num len) <span class="constant">#f</span>)
    (send <span class="string">"cs:i"</span> 1 0 dur key amp)
    (wait rhy)
    ))

(sprout (rani1 10 .2 60 72 1000))
</pre>
</div>  

<div class="float">
<p><strong>SAL</strong></p>
<pre class="code">
<span class="command">define</span> <span class="class">process</span> ranins1(len, rhy, lb, ub, amp)
  <span class="reserved">run</span> <span class="reserved">with</span> dur = rhy * 2
    <span class="reserved">repeat</span> len
    <span class="reserved">for</span> key = lb <span class="reserved">then</span> ran(lb,ub)
    <span class="reserved">send</span> <span class="string">"cs:i"</span>, 1, 0, dur, key, amp
    <span class="reserved">wait</span> rhy
  <span class="reserved">end</span>

<span class="command">sprout</span> ranins1(10, .2, 60, 72, 1000)
</pre>
</div>  




<!-- 
<h2 id="xml">XML Description</h2>

<p>Plotter saves, loads, imports and exports data using
XML entities defined in the DTD file "grace/doc/grace.dtd". </p>

<p>Users can define their own Plotter points by declaring the
point using the XML <code>&lt;<span
class="xmlentity">pointdef</span>&gt;</code> ... <code>&lt;<span
class="xmlentity">/pointdef</span>&gt;</code> entity.  Here is the
definition of Plotter's (predefined) xy point: </p>

<pre>
&lt;<span class="xmlentity">pointdef</span>&gt;
  &lt;<span class="xmlentity">name</span>&gt;xy&lt;<span class="xmlentity">/name</span>&gt;
  &lt;<span class="xmlentity">fieldlist</span>&gt;
    &lt;<span class="xmlentity">field</span>&gt; &lt;<span class="xmlentity">name</span>&gt;x&lt;<span class="xmlentity">/name</span>&gt; &lt;<span class="xmlentity">type</span>&gt;float 0 1&lt;<span class="xmlentity">/type</span>&gt; &lt;<span class="xmlentity">default</span>&gt;0&lt;<span class="xmlentity">/default</span>&gt; &lt;<span class="xmlentity">/field</span>&gt;
    &lt;<span class="xmlentity">field</span>&gt; &lt;<span class="xmlentity">name</span>&gt;y&lt;<span class="xmlentity">/name</span>&gt; &lt;<span class="xmlentity">type</span>&gt;float 0 1&lt;<span class="xmlentity">/type</span>&gt; &lt;<span class="xmlentity">default</span>&gt;0&lt;<span class="xmlentity">/default</span>&gt; &lt;<span class="xmlentity">/field</span>&gt;
  &lt;<span class="xmlentity">/fieldlist</span>&gt;
&lt;<span class="xmlentity">/pointdef</span>&gt;
</pre>


<p>Point definitions can be converted to sound by providing a <code>
&lt;<span class="xmlentity">soundmap</span>&gt; ... &lt;<span
class="xmlentity">/soundmap</span>&gt; </code> entity that describes
how to transform the point's field values into data sent to a
port. For example, this description would convert an xy point into a
Midi Port note by converting point's <var>x</var> field to a time value
between 0 and 10, the <var>y</var> field to a key number between 60 72, and
constant values for duration (.5) amplitude (.25) and channel (0):</p>

<pre>
&lt;<span class="xmlentity">soundmap</span>&gt;
  &lt;<span class="xmlentity">mp:midi </span>&gt;
    &lt;<span class="xmlentity">mp:time</span>&gt; &lt;<span class="xmlentity">source</span>&gt;x&lt;<span class="xmlentity">/source</span>&gt; &lt;<span class="xmlentity">scaler</span>&gt;10&lt;<span class="xmlentity">/scaler</span>&gt; &lt;<span class="xmlentity">/mp:time</span>&gt;
    &lt;<span class="xmlentity">mp:dur</span>&gt; &lt;<span class="xmlentity">source</span>&gt;.5&lt;<span class="xmlentity">/source</span>&gt; &lt;<span class="xmlentity">/mp:dur</span>&gt;
    &lt;<span class="xmlentity">mp:key</span>&gt; &lt;<span class="xmlentity">source</span>&gt;y&lt;<span class="xmlentity">/source</span>&gt; &lt;<span class="xmlentity">scaler</span>&gt;12&lt;<span class="xmlentity">/scaler</span>&gt; &lt;<span class="xmlentity">offset</span>&gt;60&lt;<span class="xmlentity">/offset</span>&gt; &lt;<span class="xmlentity">/mp:key</span>&gt;
    &lt;<span class="xmlentity">mp:amp</span>&gt; &lt;<span class="xmlentity">source</span>&gt;.25&lt;<span class="xmlentity">/source</span>&gt; &lt;<span class="xmlentity">scaler</span>&gt;127&lt;<span class="xmlentity">/scaler</span>&gt; &lt;<span class="xmlentity">/mp:amp</span>&gt;
    &lt;<span class="xmlentity">mp:chan</span>&gt; &lt;<span class="xmlentity">source</span>&gt;0&lt;<span class="xmlentity">/source</span>&gt; &lt;<span class="xmlentity">/mp:chan</span>&gt;
  &lt;<span class="xmlentity">/mp:midi</span>&gt;
&lt;<span class="xmlentity">/soundmap</span>&gt;
</pre>


<p>User defined XML descriptions are saved in the
Grace.prefs file:
</p>

-->

</div>
</body>
</html>

