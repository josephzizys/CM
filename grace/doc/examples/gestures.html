<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1"/>
<style type="text/css" media="all">
span.string  {color: #bc8f8f;} 
span.output  {color: #bc8f8f;} 
span.comment {color: #b22222;}  
span.keyword {color: #da70d6;} 
span.reserved {color: #a020f0;}
span.classof {color: #228b22;}
span.command {color: #0000ff;}
span.constant {color: #5f9ea0;}
pre.salcode{}
</style>
<title>gestures.html</title>
</head>
<body>
<p><span style="font-size:large;">Download source: <a href="/Lisp/grace/doc/examples/gestures.sal">
<img src="fileicon.png" style="border:none;" alt="[fileicon.png]" /> gestures.sal</a></span></p>
<hr/><pre class="salcode">
<span class="comment">;; building gestures from motives</span>

<span class="comment">;; motive1: three notes a whole step and minor seventh apart in any</span>
<span class="comment">;; order</span>

<span class="command">define</span> <span class="classof">process</span> motive1(octave, range, chan)

  <span class="reserved">run</span> <span class="reserved">with</span> pitches = make-heap({6 4 14}),
           amps = make-heap({.75 .5 .5}),
           offset = ran(range)
    <span class="reserved">repeat</span> 3
    <span class="reserved">send</span> <span class="string">"mp:midi"</span>, <span class="keyword">key:</span> next(pitches) + (octave * 12) + offset, 
         <span class="keyword">amp:</span> next(amps), <span class="keyword">chan:</span> chan, <span class="keyword">dur:</span> .1
    <span class="reserved">wait</span> .2
  <span class="reserved">end</span>

<span class="comment">;; motive2: a repeated note with one accented</span>

<span class="command">define</span> <span class="classof">process</span> motive2(octave, range, chan)
  <span class="reserved">run</span> <span class="reserved">with</span> amps = make-heap({.75 .5 .5}),
           rhys = make-heap({.2 .2 .4}),
           offset = ran(range)
    <span class="reserved">repeat</span> 3
    <span class="reserved">send</span> <span class="string">"mp:midi"</span>, <span class="keyword">key:</span> 0 + (octave * 12) + offset, 
         <span class="keyword">amp:</span> next(amps), <span class="keyword">chan:</span> chan, <span class="keyword">dur:</span> .1
    <span class="reserved">wait</span> next(rhys)
  <span class="reserved">end</span>

<span class="comment">;; listen to each motive several times</span>

<span class="command">sprout</span> motive1(5,0,0)
<span class="command">sprout</span> motive2(5,0,1)

<span class="comment">;; try motives within a range</span>

<span class="command">sprout</span> motive1(5,4,0)
<span class="command">sprout</span> motive2(5,5,1)

<span class="comment">;; make a gesture that chooses between motives two seconds apart</span>

<span class="command">define</span> <span class="classof">process</span> gesture1(times, o, chan)
  <span class="reserved">run</span> <span class="reserved">repeat</span> times
    <span class="reserved">if</span>( odds( o ) ) <span class="reserved">then</span>
      <span class="reserved">sprout</span> motive1(5, 0, chan)
    <span class="reserved">else</span>
      <span class="reserved">sprout</span> motive2(6, 0, chan)
    <span class="reserved">wait</span> 2
  <span class="reserved">end</span>

<span class="comment">;; try it</span>

<span class="command">sprout</span> gesture1(10, .5, 0)

<span class="comment">;; the same but allow transpositions</span>

<span class="command">define</span> <span class="classof">process</span> gesture2(times, o, range, chan)
  <span class="reserved">run</span> <span class="reserved">repeat</span> times
    <span class="reserved">if</span>( odds( o ) ) <span class="reserved">then</span>
      <span class="reserved">sprout</span> motive1(5,range, chan)
    <span class="reserved">else</span>
      <span class="reserved">sprout</span> motive2(6,range, chan)
    <span class="reserved">wait</span> 2
  <span class="reserved">end</span>

<span class="command">sprout</span> gesture2(10, .5, 5, 0)

<span class="comment">;; quantizing time function</span>

<span class="command">define</span> <span class="classof">function</span> step(n, maxn, s, e, quant)
  <span class="comment">;; over maxn steps move from s to e by quan step size </span>
  <span class="reserved">return</span> quantize( interp( n / maxn, 0, s, .5, e), quant)

<span class="command">loop</span> <span class="reserved">for</span> i <span class="reserved">below</span> 10
  <span class="reserved">print</span> step(i, 10, 2, 4, .25)
<span class="command">end</span>

<span class="command">define</span> <span class="classof">process</span> gesture3(times, o, range, chan, hiwait, lowwait)
  <span class="reserved">run</span> <span class="reserved">for</span> i <span class="reserved">from</span> 0 <span class="reserved">to</span> times
    <span class="reserved">if</span>( odds( o ) ) <span class="reserved">then</span>
      <span class="reserved">sprout</span> motive1(5, range, chan)
    <span class="reserved">else</span>
      <span class="reserved">sprout</span> motive2(5, range, chan)
    <span class="reserved">wait</span> step(i, times, 2, .2, .2)
  <span class="reserved">end</span>

<span class="comment">;; gesture3 makes smaller amounts of time between motives</span>

<span class="command">sprout</span> gesture3(20, .5, 5, 0, 3, .2)

<span class="command">define</span> <span class="classof">process</span> gesture4(times, lowoctave, highoctave, range, 
                        chan, hiwait, lowwait)
  <span class="reserved">run</span> <span class="reserved">for</span> i <span class="reserved">from</span> 0 <span class="reserved">to</span> times
    <span class="reserved">if</span>( odds( step(i, times, 1.0, 0.0, .01) ) ) <span class="reserved">then</span>
      <span class="reserved">sprout</span> motive1(between(lowoctave, highoctave), range, chan)
    <span class="reserved">else</span>
      <span class="reserved">sprout</span> motive2(between(lowoctave, highoctave), range, chan)
    <span class="reserved">wait</span> step(i, times, hiwait, lowwait, .2)
  <span class="reserved">end</span>

<span class="command">sprout</span> gesture4(30, 2, 7, 11, 0, 1.6,.2)

<span class="command">begin</span>
  <span class="reserved">send</span> <span class="string">"mp:prog"</span>, <span class="keyword">val:</span> 0,  <span class="keyword">chan:</span> 0
  <span class="reserved">send</span> <span class="string">"mp:prog"</span>, <span class="keyword">val:</span> 12, <span class="keyword">chan:</span> 1
  <span class="reserved">send</span> <span class="string">"mp:prog"</span>, <span class="keyword">val:</span> 46, <span class="keyword">chan:</span> 2
  <span class="reserved">sprout</span> gesture4(60, 2, 7, 11, 0, 1.0, .2)
  <span class="reserved">sprout</span> gesture4(40, 5, 7, 11, 1, 1.6, .2)
  <span class="reserved">sprout</span> gesture4(34, 3, 6, 11,  2, 2.0, .2)
<span class="command">end</span>






</pre>
</pre>
<hr/>
<div style="float:left;"><p>Generated by <em>sal2html</em> Sun Apr 20 10:09:46 2008</p></div><div style="float:right;"><a href="http://validator.w3.org/check?uri=referer"><img src="http://www.w3.org/Icons/valid-xhtml10-blue" style="border:none;" alt="Valid XHTML 1.0 Strict" height="31" width="88"/></a></div>
</body>
</html>
