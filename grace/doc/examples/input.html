<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1"/>
<style type="text/css" media="all">
span.string  {color: #bc8f8f;} 
span.output  {color: #bc8f8f;} 
span.comment {color: #b22222;}  
span.keyword {color: #da70d6;} 
span.reserved {color: #a020f0;}
span.classof {color: #228b22;}
span.command {color: #0000ff;}
span.constant {color: #5f9ea0;}
pre.salcode{}
</style>
<title>input.html</title>
</head>
<body>
<p><span style="font-size:large;">Download source: <a href="/Lisp/grace/doc/examples/input.sal">
<img src="fileicon.png" style="border:none;" alt="[fileicon.png]" /> input.sal</a></span></p>
<hr/><pre class="salcode">
<span class="comment">;; A 1st order Markov harmonizer a la messiaen</span>

<span class="comment">;; a first order markov pattern geneates diatonic and chromatic</span>
<span class="comment">;; intervals to produce Messiaen-like sonorites</span>

<span class="command">define</span> <span class="classof">variable</span> mark =
  make-markov( {
                {1 -&gt; {1 .25} {2 2} {3 .5} {4 .4} {5 .3} {6 .1} }
                {2 -&gt; {3 1} {4 .5} {5 .3} {6 .2} }
                {3 -&gt; {1 .2} {2 1} {4 .5} {5 .3} {6 .2} }
                {4 -&gt; {1 .2} {2 1} {3 .4} {4 .3} {6 .2} }
                {5 -&gt; {1 1} {2 1} {3 .5} {4 .5} {5 .5} {6 .5} }
                {6 -&gt; {1 1} {2 1} {3 .5} {4 .5} {5 .5} }
                } )

<span class="comment">;; try it out </span>

<span class="command">begin</span> <span class="reserved">with</span> n = 5
  <span class="reserved">print</span> note( scale( n, 60, next(mark, n - 1)))
<span class="command">end</span>

<span class="comment">;; define a player for chords</span>

<span class="command">define</span> <span class="classof">function</span> playchord( ch, d, a)
  <span class="reserved">loop</span> <span class="reserved">for</span> c <span class="reserved">in</span> ch
    <span class="reserved">send</span> <span class="string">"mp:midi"</span>, <span class="keyword">key:</span> c, <span class="keyword">dur:</span> d, <span class="keyword">amp:</span> a
   <span class="reserved">end</span>

<span class="comment">;; try out the player</span>

<span class="command">begin</span> <span class="reserved">with</span> n = 5
p  <span class="reserved">exec</span> playchord( scale( n, 60, next( mark, n - 1)),
                  1, .7)
<span class="command">end</span>

<span class="comment">;; define a midi hook. The louder the note the more chord tones are</span>
<span class="comment">;; added</span>

<span class="command">define</span> <span class="classof">function</span> chordhook(mm)
  <span class="reserved">if</span> mm:on?( mm) <span class="reserved">then</span>
    <span class="reserved">begin</span> 
      <span class="reserved">with</span> n = int( interp( mm:vel( mm), 20, 2, 100, 6))
      <span class="comment">;; the louder we play the more notes are added</span>
      <span class="reserved">exec</span> playchord( scale(n, mm:key( mm), next(mark, n - 1)),
                      .5, mm:vel(mm))
    <span class="reserved">end</span>

<span class="comment">;; Set the inhook. First make sure to turn off active senseing on the</span>
<span class="comment">;; Midi In port!</span>

<span class="command">send</span> <span class="string">"mp:inhook"</span>, chordhook

<span class="comment">;; clear the hook when you are done</span>

<span class="command">send</span> <span class="string">"mp:inhook"</span>, <span class="constant">#f</span>
</pre>
</pre>
<hr/>
<div style="float:left;"><p>Generated by <em>sal2html</em> Sun Apr 20 10:09:46 2008</p></div><div style="float:right;"><a href="http://validator.w3.org/check?uri=referer"><img src="http://www.w3.org/Icons/valid-xhtml10-blue" style="border:none;" alt="Valid XHTML 1.0 Strict" height="31" width="88"/></a></div>
</body>
</html>
