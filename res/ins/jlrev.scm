(definstrument (jl-reverb (decay 3.0))
  (let* ((allpass1 (make-all-pass -0.700 0.700 2111))
	 (allpass2 (make-all-pass -0.700 0.700  673))
	 (allpass3 (make-all-pass -0.700 0.700  223))
	 (comb1 (make-comb 0.742 9601))
	 (comb2 (make-comb 0.733 10007))
	 (comb3 (make-comb 0.715 10799))
	 (comb4 (make-comb 0.697 11597))
	 (outdel1 (make-delay (seconds->samples .013)))
	 (outdel2 (make-delay (seconds->samples .011)))
	 (comb-sum 0.0)
	 (decay-dur (* decay (mus-srate)))
	 (len (floor (+ decay-dur (length *reverb*)))))
    (run
     (do ((i 0 (+ i 1)))
	 ((= i len))
       (let ((allpass-sum (all-pass allpass3 (all-pass allpass2 (all-pass allpass1 (ina i *reverb*))))))
	 (set! comb-sum 
	       (+ (comb comb1 allpass-sum)
		  (comb comb2 allpass-sum)
		  (comb comb3 allpass-sum)
		  (comb comb4 allpass-sum)))
	 (outa i (delay outdel1 comb-sum))
	 (outb i (delay outdel2 comb-sum)))))))
